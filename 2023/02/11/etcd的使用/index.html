<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>etcd的使用 | Zero(˶˚ ᗨ ˚˶)</title><meta name="author" content="Zero"><meta name="copyright" content="Zero"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="etcd学习篇章1. etcd是什么?官网原话:   A distributed, reliable key-value store for the most critical data of a distributed system。  翻译: 分布式系统中最关键数据的分布式、可靠的键值结构存储。  etcd是由Go语言编写的一种高度一致性的分布式键值结构存储系统。它可以以一种非常可靠的方式来存">
<meta property="og:type" content="article">
<meta property="og:title" content="etcd的使用">
<meta property="og:url" content="https://zlx2019.github.io/2023/02/11/etcd%E7%9A%84%E4%BD%BF%E7%94%A8/index.html">
<meta property="og:site_name" content="Zero(˶˚ ᗨ ˚˶)">
<meta property="og:description" content="etcd学习篇章1. etcd是什么?官网原话:   A distributed, reliable key-value store for the most critical data of a distributed system。  翻译: 分布式系统中最关键数据的分布式、可靠的键值结构存储。  etcd是由Go语言编写的一种高度一致性的分布式键值结构存储系统。它可以以一种非常可靠的方式来存">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://movies-bucket.oss-cn-beijing.aliyuncs.com/95443c0654a7422fa17e4da7a1e6c493.jpeg">
<meta property="article:published_time" content="2023-02-10T16:54:19.000Z">
<meta property="article:modified_time" content="2023-03-01T07:32:40.161Z">
<meta property="article:author" content="Zero">
<meta property="article:tag" content="云原生">
<meta property="article:tag" content="中间件">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://movies-bucket.oss-cn-beijing.aliyuncs.com/95443c0654a7422fa17e4da7a1e6c493.jpeg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://zlx2019.github.io/2023/02/11/etcd%E7%9A%84%E4%BD%BF%E7%94%A8/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-right"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'etcd的使用',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-03-01 15:32:40'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/element-ui@2.15.6/packages/theme-chalk/lib/index.css"><link rel="stylesheet" href="/css/bcustom.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"/>
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">104</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">61</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">37</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><i class="fa-fw icon-home"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-home"></use></svg><span> 首页</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/archives/"><i class="fa-fw icon-rili"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-rili"></use></svg><span> 归档</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/tags/"><i class="fa-fw icon-biaoqian"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-biaoqian"></use></svg><span> 标签</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/categories/"><i class="fa-fw icon-fenlei"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-fenlei"></use></svg><span> 分类</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover" href="javascript:void(0);"><i class="fa-fw fas fa-list hide"></i><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-yinle"></use></svg><span> 音乐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/movies/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-bilibili"></use></svg><span> 视频</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/link/"><i class="fa-fw icon-31haoyou"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-31haoyou"></use></svg><span> 友链</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><i class="fa-fw icon-guanyuwo"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-guanyuwo"></use></svg><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://movies-bucket.oss-cn-beijing.aliyuncs.com/95443c0654a7422fa17e4da7a1e6c493.jpeg')"><nav id="nav"><span id="blog-info"><a href="/" title="Zero(˶˚ ᗨ ˚˶)"><span class="site-name">Zero(˶˚ ᗨ ˚˶)</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><i class="fa-fw icon-home"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-home"></use></svg><span> 首页</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/archives/"><i class="fa-fw icon-rili"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-rili"></use></svg><span> 归档</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/tags/"><i class="fa-fw icon-biaoqian"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-biaoqian"></use></svg><span> 标签</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/categories/"><i class="fa-fw icon-fenlei"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-fenlei"></use></svg><span> 分类</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover" href="javascript:void(0);"><i class="fa-fw fas fa-list hide"></i><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-yinle"></use></svg><span> 音乐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/movies/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-bilibili"></use></svg><span> 视频</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/link/"><i class="fa-fw icon-31haoyou"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-31haoyou"></use></svg><span> 友链</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><i class="fa-fw icon-guanyuwo"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-guanyuwo"></use></svg><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">etcd的使用</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-02-10T16:54:19.000Z" title="发表于 2023-02-11 00:54:19">2023-02-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-03-01T07:32:40.161Z" title="更新于 2023-03-01 15:32:40">2023-03-01</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Etcd/">Etcd</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">5.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>21分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="etcd的使用"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="etcd学习篇章"><a href="#etcd学习篇章" class="headerlink" title="etcd学习篇章"></a>etcd学习篇章</h1><h2 id="1-etcd是什么"><a href="#1-etcd是什么" class="headerlink" title="1. etcd是什么?"></a>1. etcd是什么?</h2><p><a target="_blank" rel="noopener" href="https://etcd.io/">官网原话:</a></p>
<blockquote>
<p> A distributed, reliable key-value store for the most critical data of a distributed system。</p>
</blockquote>
<p>翻译: <strong>分布式系统中最关键数据的分布式、可靠的键值结构存储。</strong></p>
<blockquote>
<p><strong>etcd</strong>是由Go语言编写的一种<strong>高度一致性</strong>的分布式键值结构存储系统。它可以以一种<strong>非常可靠</strong>的方式来存储一些可能会被分布式系统或者及机器集群所要访问的重要数据。它在网络分区期间优雅地处理领导选举，并且可以容忍机器故障,哪怕是leader节点故障。</p>
</blockquote>
<h2 id="2-etcd的特点"><a href="#2-etcd的特点" class="headerlink" title="2. etcd的特点"></a>2. etcd的特点</h2><ol>
<li>基于标准化的HTTP协议进行操作,使用json数据格式进行交互。</li>
<li>数据存储在分层组织的目录中,如同标准文件系统一样。</li>
<li>支持数据监听。</li>
<li>支持ssl证书访问。</li>
<li>每个实例以每秒 1000 次写入为基准。</li>
<li>支持数据有效期。</li>
<li>通过 Raft 协议正确分发。</li>
</ol>
<h2 id="3-etcd使用场景"><a href="#3-etcd使用场景" class="headerlink" title="3. etcd使用场景"></a>3. etcd使用场景</h2><p><strong>etcd</strong>通常用来管理一些<strong>控制数据</strong>和<strong>业务数据</strong>。对于<strong>业务数据</strong>只推荐那些<strong>数据量较小,但是经常执行更新操作,并且要求强一致性的数据</strong>。</p>
<p>常见的使用场景有如下几种:</p>
<ul>
<li>服务注册与发现</li>
<li>服务配置中心</li>
<li>分布式锁</li>
<li>分布式队列</li>
<li>分布式调度协调</li>
<li>等等…</li>
</ul>
<h2 id="4-etcd与zk的区别"><a href="#4-etcd与zk的区别" class="headerlink" title="4. etcd与zk的区别"></a>4. etcd与zk的区别</h2><p>就目前来看etcd与zookeeper有着很大的相似之处,那么为什么有了zk还要etcd呢？换句话说etcd比zk有哪方面的优势与区别呢? 有如下几点:</p>
<ol>
<li>与zk相比 etcd的安装、部署和使用更加简单容易。</li>
<li>etcd在<strong>数据一致性</strong>方面更加可靠,zk虽然也是主打<strong>一致性</strong>,但是并没有etcd达到极致。</li>
<li>在服务发现的实现上,zk使用的是<strong>临时节点</strong>,而<strong>临时节点</strong>存在着许多问题。而etcd使用的是<strong>节点租约(Lease)</strong>,并且支持Group(多key)。</li>
<li>etcd在<strong>Watch</strong>机制上更加强大稳定,它可以做到长久监听,而zk的<strong>Watch</strong>机制触发一次后就会失效。</li>
<li>etcd支持<strong>MVCC(多版本并发控制-无锁机制)</strong>,因为有协同系统需要无锁操作。</li>
<li>etcd支持的数据存储规模更大,支持上百万至千万的KV数据存储。</li>
</ol>
<p>目前etcd是<strong>Kubernetes</strong>的首要数据存储组件,在整个云原生体系中都有着极高的地位。在Go领域的各大分布式框架中,etcd更是首要人物,可谓是上天的宠儿~</p>
<h2 id="5-etcd的安装"><a href="#5-etcd的安装" class="headerlink" title="5. etcd的安装"></a>5. etcd的安装</h2><h3 id="1-单节点安装"><a href="#1-单节点安装" class="headerlink" title="1. 单节点安装"></a>1. 单节点安装</h3><p><a target="_blank" rel="noopener" href="https://github.com/etcd-io/etcd/releases/">下载地址</a></p>
<p>这里选用的版本为 <a target="_blank" rel="noopener" href="https://github.com/etcd-io/etcd/releases/download/v3.5.7/etcd-v3.5.7-linux-arm64.tar.gz">3.5.7</a></p>
<p>下载完后直接解压即可</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">tar -zxvf etcd-v3.5.7-linux-arm64.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>然后就可以直接运行</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">cd etcd-v3.5.7-linux-arm64
./etcd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>一个etcd就简简单单的安装完成了。</p>
<p>我使用的mac系统,似乎直接安装系统不兼容,所以进行源码安装。</p>
<p><strong>源码编译安装</strong></p>
<p>注意:源码安装需要Go的开发环境哦~</p>
<p>首先克隆源码仓库到本地</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">git clone -b v3.5.7 https://github.com/etcd-io/etcd.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>然后进入仓库</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">cd etcd-3.5.7 <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>进行编译</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">./build.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>然后慢慢等待即可.</p>
<p>直到出现如下界面:</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">....
....
stderr: go: downloading github.com/urfave/cli v1.22.4
SUCCESS: etcd_build (GOARCH=)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>编译好的可执行文件在目录的<code>bin</code>文件夹</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">cd bin
ls 
etcd	etcdctl	etcdutl<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>查看etcd的版本</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% ./etcd --version
etcd Version: 3.5.7
Git SHA: GitNotFound
Go Version: go1.18.1
Go OS/Arch: darwin/arm64<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>运行</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">./etcd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>如果有需要也可以将该<code>bin</code>目录配置到环境变量中</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">export PATH="$PATH:*****/etcd-3.5.7/bin"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>当etcd启动后,可以通过<code>http://localhost:2379</code>来访问可视化界面。</p>
<h3 id="2-单机集群部署"><a href="#2-单机集群部署" class="headerlink" title="2. 单机集群部署"></a>2. 单机集群部署</h3><p><strong>etcd server默认使用2380端口来监听集群中其他的节点的请求</strong>,如果一台机器上启动多个etcd节点,那么端口就会产生冲突.所以如果要在一台机器上搭建etcd集群,那么端口一定要注意交错开。</p>
<p>下面我们创建一个etcd集群,3个节点(一个集群至少3个节点),通过进程管理工具goreman来快速创建、停止etcd集群。</p>
<p><strong>安装goreman</strong></p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">go install github.com/mattn/goreman@latest

go: downloading github.com/mattn/goreman v0.3.13
go: downloading golang.org/x/sys v0.0.0-20220708085239-5a0f0661e09d
go: downloading github.com/joho/godotenv v1.4.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后创建etcd集群配置文件:</p>
<p>单个节点配置格式:</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">节点序号: etcd --name 节点名称 
				--listen-client-urls 客户端连接端口 
				--advertise-client-urls 如果有多个客户端连接的情况下推荐使用的连接 
				--listen-peer-urls 节点之间互相通信选举的端口
				--initial-cluster-token 集群的token
				--initial-cluster-state 初始化时集群的状态
				--initial-cluster 所有的节点(节点名称:节点通信选举端口)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>完整配置文件内容:</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">etcd1: etcd --name node1 --listen-client-urls http://127.0.0.1:12379 --advertise-client-urls http://127.0.0.1:12379 --listen-peer-urls http://127.0.0.1:12380 --initial-cluster-token etcd-cluster-token --initial-cluster-state new --initial-cluster 'node1=http://127.0.0.1:12380,node2=http://127.0.0.1:22380,node3=http://127.0.0.1:32380'

etcd2: etcd --name node2 --listen-client-urls http://127.0.0.1:22379 --advertise-client-urls http://127.0.0.1:22379 --listen-peer-urls http://127.0.0.1:22380 --initial-cluster-token etcd-cluster-token --initial-cluster-state new --initial-cluster 'node1=http://127.0.0.1:12380,node2=http://127.0.0.1:22380,node3=http://127.0.0.1:32380'

etcd3: etcd --name node3 --listen-client-urls http://127.0.0.1:32379 --advertise-client-urls http://127.0.0.1:32379 --listen-peer-urls http://127.0.0.1:32380 --initial-cluster-token etcd-cluster-token --initial-cluster-state new --initial-cluster 'node1=http://127.0.0.1:12380,node2=http://127.0.0.1:22380,node3=http://127.0.0.1:32380'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>参数详细说明</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>—name</td>
<td>本节点的名称</td>
</tr>
<tr>
<td>—listen-client-urls</td>
<td>本节点客户端可以连接的端口(可以有多个)(默认为:<a target="_blank" rel="noopener" href="http://locahost:2379">http://locahost:2379</a>)</td>
</tr>
<tr>
<td>—advertise-client-urls</td>
<td>推荐使用的客户端连接端口(如果有多个的情况下)</td>
</tr>
<tr>
<td>—listen-peer-urls</td>
<td>与其他服务端节点通信选举的端口(可以有多个)(默认为:<a target="_blank" rel="noopener" href="http://locahost:2380">http://locahost:2380</a>)</td>
</tr>
<tr>
<td>—initial-advertise-peer-urls</td>
<td>推荐使用的服务端节点通信端口</td>
</tr>
<tr>
<td>—initial-cluster-token</td>
<td></td>
</tr>
<tr>
<td>—initial-cluster-state</td>
<td>初始化集群的状态,’new’表示新建的集群,’existing’表示加入已存在的集群</td>
</tr>
<tr>
<td>—initial-cluster</td>
<td>所有要加入集群的节点的通信地址。启动时,集群根据该配置找到所有节点。<br>‘node1name:ip:通信port,node2name:ip:通信port,…..’</td>
</tr>
</tbody>
</table>
</div>
<p>接下来就可以通过goreman读取该配置文件,启动etcd集群:</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">goreman -f ./cluster-profile start

03:34:52 etcd2 | Starting etcd2 on port 5100
03:34:52 etcd1 | Starting etcd1 on port 5000
03:34:52 etcd3 | Starting etcd3 on port 5200
......<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>启动完成以后,我们访问任意一个节点,都会获取集群所有节点的信息:</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl --endpoints=localhost:12379 member list
6ad1063bfbf8109a, started, node1, http://127.0.0.1:12380, http://127.0.0.1:12379, false
b97e3c6361bc17b8, started, node2, http://127.0.0.1:22380, http://127.0.0.1:22379, false
ed32a2a50a061fea, started, node3, http://127.0.0.1:32380, http://127.0.0.1:32379, false<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>单独关闭某个节点</strong></p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">goreman run stop etcd2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>单独启动某个节点</strong></p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">goreman run start etcd2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>单独重启某个节点</strong></p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">goreman run restart etcd2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>向其中一个节点写入数据</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl put name 张三 --endpoints=localhost:22379
OK<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>然后从另一个节点中读取</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl get name --endpoints=localhost:32379  
name
张三<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>显然是可以获取到的.</p>
<h2 id="6-基础数据操作"><a href="#6-基础数据操作" class="headerlink" title="6. 基础数据操作"></a>6. 基础数据操作</h2><p>etcd的命令行工具提供了大量命令对数据进行操作,接下来我们来一一使用并且解释其作用.</p>
<h3 id="help"><a href="#help" class="headerlink" title="help"></a>help</h3><p>获取命令帮助。</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">zero@Zero ~ % etcdctl help
NAME:
	etcdctl - A simple command line client for etcd3.

USAGE:
	etcdctl [flags]

VERSION:
	3.5.7

API VERSION:
	3.5


COMMANDS:
	alarm disarm		Disarms all alarms
	alarm list		Lists all alarms
	auth disable		Disables authentication
	auth enable		Enables authentication
	auth status		Returns authentication status
	check datascale		Check the memory usage of holding data for different workloads on a given server endpoint.
	check perf		Check the performance of the etcd cluster
	compaction		Compacts the event history in etcd
	defrag			Defragments the storage of the etcd members with given endpoints
	del			Removes the specified key or range of keys [key, range_end)
	elect			Observes and participates in leader election
	endpoint hashkv		Prints the KV history hash for each endpoint in --endpoints
	endpoint health		Checks the healthiness of endpoints specified in `--endpoints` flag
	endpoint status		Prints out the status of endpoints specified in `--endpoints` flag
	get			Gets the key or a range of keys
	help			Help about any command
	lease grant		Creates leases
	lease keep-alive	Keeps leases alive (renew)
	lease list		List all active leases
	lease revoke		Revokes leases
	lease timetolive	Get lease information
	lock			Acquires a named lock
	make-mirror		Makes a mirror at the destination etcd cluster
	member add		Adds a member into the cluster
	member list		Lists all members in the cluster
	member promote		Promotes a non-voting member in the cluster
	member remove		Removes a member from the cluster
	member update		Updates a member in the cluster
	move-leader		Transfers leadership to another etcd cluster member.
	put			Puts the given key into the store
	role add		Adds a new role
	role delete		Deletes a role
	role get		Gets detailed information of a role
	role grant-permission	Grants a key to a role
	role list		Lists all roles
	role revoke-permission	Revokes a key from a role
	snapshot restore	Restores an etcd member snapshot to an etcd directory
	snapshot save		Stores an etcd node backend snapshot to a given file
	snapshot status		[deprecated] Gets backend snapshot status of a given file
	txn			Txn processes all the requests in one transaction
	user add		Adds a new user
	user delete		Deletes a user
	user get		Gets detailed information of a user
	user grant-role		Grants a role to a user
	user list		Lists all users
	user passwd		Changes password of user
	user revoke-role	Revokes a role from a user
	version			Prints the version of etcdctl
	watch			Watches events stream on keys or prefixes

OPTIONS:
      --cacert=""				verify certificates of TLS-enabled secure servers using this CA bundle
      --cert=""					identify secure client using this TLS certificate file
      --command-timeout=5s			timeout for short running command (excluding dial timeout)
      --debug[=false]				enable client-side debug logging
      --dial-timeout=2s				dial timeout for client connections
  -d, --discovery-srv=""			domain name to query for SRV records describing cluster endpoints
      --discovery-srv-name=""			service name to query when using DNS discovery
      --endpoints=[127.0.0.1:2379]		gRPC endpoints
  -h, --help[=false]				help for etcdctl
      --hex[=false]				print byte strings as hex encoded strings
      --insecure-discovery[=true]		accept insecure SRV records describing cluster endpoints
      --insecure-skip-tls-verify[=false]	skip server certificate verification (CAUTION: this option should be enabled only for testing purposes)
      --insecure-transport[=true]		disable transport security for client connections
      --keepalive-time=2s			keepalive time for client connections
      --keepalive-timeout=6s			keepalive timeout for client connections
      --key=""					identify secure client using this TLS key file
      --password=""				password for authentication (if this option is used, --user option shouldn't include password)
      --user=""					username[:password] for authentication (prompt if password is not supplied)
  -w, --write-out="simple"			set the output format (fields, json, protobuf, simple, table)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="设置K-V数据"><a href="#设置K-V数据" class="headerlink" title="设置K-V数据"></a>设置K-V数据</h3><p>设置数据</p>
<p>命令格式:<code>etcdctl put key value</code></p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl put name 张三
OK<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="读取K-V数据"><a href="#读取K-V数据" class="headerlink" title="读取K-V数据"></a>读取K-V数据</h3><p><strong>根据Key获取对应的值数据</strong></p>
<p>命令格式: <code>etcdctl get key</code></p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl get name
name
张三<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>读取指定节点的数据</strong></p>
<p>命令格式: <code>etcdctl get key --endpoints=节点ip:端口</code></p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl get name --endpoints=localhost:2379
name
张三<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>获取数据,以十六进制格式返回</strong></p>
<p>使用<code>--hex</code>参数表示以十六进制格式返回</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">etcdctl get name --hex

\x6e\x61\x6d\x65
\xe5\xbc\xa0\xe4\xb8\x89<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>获取两个key范围之间的所有数据</strong></p>
<p>命令格式: <code>etcdctl get key1 key2</code></p>
<p>返回key1到key2区间的所有key数据(包含key1,但不包含key2的数据)</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl put /service/user1 张三
OK
% etcdctl put /service/user2 李四
OK
% etcdctl put /service/user3 王五
OK
% etcdctl put /service/user4 赵六
OK


% etcdctl get /service/user1 /service/user4
/service/user1
张三
/service/user2
李四
/service/user3
王五<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>根据key的前缀匹配获取数据</strong></p>
<p>通过<code>--prefix</code>参数匹配前缀获取</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl get --prefix /service
/service/user1
张三
/service/user2
李四
/service/user3
王五
/service/user4
赵六<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>通过<code>--limit number</code>参数限流返回的结果数量</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl get --prefix --limit 1 /service
/service/user1
张三<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>根据key的字典顺序大小获取数据</strong></p>
<p>如下: 获取顺序大于或等于<code>/service/user2</code>的数据</p>
<p>通过<code>--from-key</code>参数</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl get --from-key /service/user2
/service/user2
李四
/service/user3
王五
/service/user4
赵六<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>获取一个数据的详细信息</strong></p>
<p>如下,我们针对<code>/item/user</code>进行了多次修改,在数据内部,会有一个<code>version</code>记录数据被修改的次数.</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl put /item/user Hello
OK
zero@Zero ~ % etcdctl put /item/user World
OK<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>获取数据的详细信息</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl get /item/user -w json <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><code>-w json</code>表示以json格式返回结果,会获取到如下结果:</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span><span class="token property">"header"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"cluster_id"</span><span class="token operator">:</span><span class="token number">14841639068965178418</span><span class="token punctuation">,</span><span class="token property">"member_id"</span><span class="token operator">:</span><span class="token number">10276657743932975437</span><span class="token punctuation">,</span><span class="token property">"revision"</span><span class="token operator">:</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token property">"raft_term"</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"kvs"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">"key"</span><span class="token operator">:</span><span class="token string">"L2l0ZW0vdXNlcg=="</span><span class="token punctuation">,</span><span class="token property">"create_revision"</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">"mod_revision"</span><span class="token operator">:</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token property">"version"</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">"value"</span><span class="token operator">:</span><span class="token string">"V29ybGQ="</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"count"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>参数解释如下:</p>
<p>cluster_id: 当前访问的etcd的集群ID</p>
<p>member_id: 当前访问的etcd的节点ID</p>
<p>revision: 全局数据的控制版本号,对任何一个key进行修改后,该数值都会+1。默认初始化为1,因为修改数据版本从2开始。</p>
<p>raft_term： etcd当前raft主节点任期号。</p>
<p>create_revision：该key创建时,全局数据的版本号的值。</p>
<p>mod_revision：该key最后一次修改时,全局数据的版本号的值。</p>
<p>version：该key的数据版本号,创建时为1,对key进行put操作会自增1,如果删除后重新创建又会从1开始。</p>
<p><strong>获取数据的旧版本值</strong></p>
<p>通过<code>--rev=n</code> 获取key第n个版本的值,注意: 这个<code>n</code>是全局数据版本号,而不是该key数据版本号哦.</p>
<p>如获取<code>/item/user</code>初始化时的值,创建<code>/item/user</code>时,全局版本号为10,所以要通过<code>--rev=10</code>参数获取初始化值</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">etcdctl get --rev=10 /item/user<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>如果要获取更往前版本的值,只需要把版本号往前写即可,前提是有这些版本。</p>
<h3 id="删除K-V数据"><a href="#删除K-V数据" class="headerlink" title="删除K-V数据"></a>删除K-V数据</h3><p>删除数据</p>
<p>删除单个数据:<code>etcdctl del key</code></p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl del name
1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>范围删除: <code>etcdctl del key1 key2</code></p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">etcdctl del node1 node2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>根据key前缀批量删除数据</strong></p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">etcdctl del --prefix /service<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>删除时并且返回数据</strong></p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl del name --prev-kv
1
name
张三<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="7-Watch监听"><a href="#7-Watch监听" class="headerlink" title="7. Watch监听"></a>7. Watch监听</h2><p><code>Watch</code>机制能够监听某一个key数据的操作,并且只要连接不断,就会持续监听。</p>
<p>如下,我们监听key为<code>/user</code>的数据:</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl watch /user
# ...进入阻塞状态<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>然后我们再次打开一个新的终端</p>
<p>这个时候,是没有这个key的,接下来我们来创建这个key:</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl put /user root  
OK<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>创建完成,这个时候监听终端则会发生如下变化:</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl watch /user

PUT
/user
root<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>PUT</code> 表示监听到的事件为新增或者修改.</p>
<p><code>/user</code>表示监听的Key.</p>
<p><code>root</code>表示新增或者修改的值.</p>
<p>然后我们还可以再次修改:</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl put /user newRoot
OK<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl watch /user
PUT
/user
root
#-----------------
PUT
/user
newRoot<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>只要终端连接没有断开,那么这监听就是持久性的.</p>
<p>当然它也可以监听到删除事件:</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl del /user
1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl watch /user
...
DELETE
/user<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="8-Lease租约"><a href="#8-Lease租约" class="headerlink" title="8. Lease租约"></a>8. Lease租约</h2><p>简单来说就是指定一个key的有效时间,超过了这个时间后,key将会失效.类似于Redis中的ttl。</p>
<p>租约和Key是隔离开的,其使用方式为:创建一个租约,然后绑定到key中。</p>
<h3 id="1-创建租约"><a href="#1-创建租约" class="headerlink" title="1. 创建租约"></a>1. 创建租约</h3><p>命令格式: <code>etcdctl lease grant &lt;number&gt;</code> 时间单位为秒.</p>
<p>如下命令,创建一个有效期为10s的租约:</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl lease grant 10 
lease 694d8640f7eb832e granted with TTL(10s)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>这里会返回一个租约的标识,使用该租约只要通过该标识即可。</p>
<h3 id="2-查看租约信息"><a href="#2-查看租约信息" class="headerlink" title="2. 查看租约信息"></a>2. 查看租约信息</h3><p>命令格式: <code>etcdctl lease timetolive &lt;lease_id&gt;</code></p>
<p>查看租约是否已经过期</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl lease grant 50                   
lease 694d8640f7eb8331 granted with TTL(50s)

% etcdctl lease timetolive 694d8640f7eb8331
lease 694d8640f7eb8331 granted with TTL(50s), remaining(37s)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以看到,该租约目前还没有过期,一共时长为50s,当前还剩余37s。</p>
<p>当时间过期后,再次查询:</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl lease timetolive 694d8640f7eb8331
lease 694d8640f7eb8331 already expired<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>显示<code>694d8640f7eb8331</code>租约已经过期。</p>
<p>也可以通过<code>--keys</code>查看多个租约:</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">etcdctl lease timetolive --keys &lt;ids...&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="3-查看有效的租约列表"><a href="#3-查看有效的租约列表" class="headerlink" title="3. 查看有效的租约列表"></a>3. 查看有效的租约列表</h3><p>命令格式: <code>etcdctl lease list</code></p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl lease list    
found 1 leases
694d8640f7eb8334<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>可以看到,目前只有一个有效的租约。</p>
<h3 id="4-使用租约"><a href="#4-使用租约" class="headerlink" title="4. 使用租约"></a>4. 使用租约</h3><p>在创建key时,通过<code>--lease=&lt;lease_id&gt;</code> 来指定租约.</p>
<p>如下,创建一个有效期为100s的租约,并且使用在key上.</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl lease grant 100
lease 694d8640f7eb833d granted with TTL(100s)

% etcdctl put --lease=694d8640f7eb833d /username 张三
OK

% etcdctl get /username -w fields
"ClusterID" : 14841639068965178418
"MemberID" : 10276657743932975437
"Revision" : 18
"RaftTerm" : 3
"Key" : "/username"
"CreateRevision" : 18
"ModRevision" : 18
"Version" : 1
"Value" : "张三"
"Lease" : 7587868560784589629
"More" : false
"Count" : 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>当租约过期后,该key也会消除掉。</p>
<p>等待时间过后我们再次查询该key:</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl get /username     
...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>没有看到任何数据。</p>
<h3 id="5-撤销租约"><a href="#5-撤销租约" class="headerlink" title="5. 撤销租约"></a>5. 撤销租约</h3><p>命令格式: <code>etcdctl lease revoke &lt;lease_id&gt;</code></p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">etcdctl lease revoke 694d8640f7eb8337                 
lease 694d8640f7eb8337 revoked<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>注意:<strong>如果租约被撤销了,那么正在使用该租约的所有key，都会被删除掉</strong>:</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh"># 创建租约
etcdctl lease grant 300                             
lease 694d8640f7eb834b granted with TTL(300s)

# 使用租约
% etcdctl put --lease=694d8640f7eb834b /user/admin zhangsan           
OK

# 查看数据
% etcdctl get /user/admin
/user/admin
zhangsan

# 撤销租约
% etcdctl lease revoke 694d8640f7eb834b
lease 694d8640f7eb834b revoked

# 再次查看数据,发现数据也不存在了
% etcdctl get /user/admin  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="5-刷新租约"><a href="#5-刷新租约" class="headerlink" title="5. 刷新租约"></a>5. 刷新租约</h3><p>命令格式:<code>etcdctl lease keep-alive &lt;lease_id&gt;</code></p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl lease keep-alive 694d8640f7eb8352
lease 694d8640f7eb8352 keepalived with TTL(100)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>比如一个租约为100s,现在这个租约马上到期了,我们只需要刷新一下该租约,租约的有效期就会重新刷新为100s。</p>
<p><strong>在分布式锁的实现上,使用etcd会有很大的优势,因为etcd的租约可以同时被多个key所绑定,如果租约进行续约了,会同时影响到所有被绑定的key。</strong></p>
<h2 id="9-权限管理"><a href="#9-权限管理" class="headerlink" title="9. 权限管理"></a>9. 权限管理</h2><p>etcd默认是关闭权限控制的,也就是任何连接都可以进行操作。</p>
<h3 id="1-权限状态"><a href="#1-权限状态" class="headerlink" title="1. 权限状态"></a>1. 权限状态</h3><p><code>etcdctl auth status</code>: 查看权限管理状态</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl auth status
Authentication Status: false
AuthRevision: 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>当前状态为<code>false</code>。未开启。</p>
<h3 id="2-开启权限管理"><a href="#2-开启权限管理" class="headerlink" title="2. 开启权限管理"></a>2. 开启权限管理</h3><p><code>etcdctl auth enable</code>: 开启etcd的权利管理</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl auth enable
....
Error: etcdserver: root user does not exist<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>要想开启权利管理,首先必须要有一个<code>root</code>用户.接下来我们创建一个root用户:</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh"># 添加一个root用户
% etcdctl user add root 
# 输入密码
Password of root: 
# 确认密码
Type password of root again for confirmation: 
User root created<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里的密码和用户保持一致,为<code>root</code>。</p>
<p>然后再次打开权限管理:</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl auth enable  
{"level":"warn","ts":"2023-02-12T23:18:19.907+0800","logger":"etcd-client","caller":"v3@v3.5.7/retry_interceptor.go:62","msg":"retrying of unary invoker failed","target":"etcd-endpoints://0x1400019c000/127.0.0.1:2379","attempt":0,"error":"rpc error: code = FailedPrecondition desc = etcdserver: root user does not have root role"}
Authentication Enabled<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>表示打开成功.这个时候你再对etcd做任何操作的时候,都需要通过权限认证.否则无法执行,错误操作如下:</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl put /test/123 data1 
{"level":"warn","ts":"2023-02-12T23:23:14.711+0800","logger":"etcd-client","caller":"v3@v3.5.7/retry_interceptor.go:62","msg":"retrying of unary invoker failed","target":"etcd-endpoints://0x14000228000/127.0.0.1:2379","attempt":0,"error":"rpc error: code = InvalidArgument desc = etcdserver: user name is empty"}
Error: etcdserver: user name is empty<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>这个时候必须要使用拥有相关权限的用户才能执行操作:</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl put /test/123 data1 --user=root
# 输入root用户的密码
Password: 
OK<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="3-关闭权限管理"><a href="#3-关闭权限管理" class="headerlink" title="3. 关闭权限管理"></a>3. 关闭权限管理</h3><pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl auth disable --user=root
Password: 
Authentication Disabled<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="10-用户管理"><a href="#10-用户管理" class="headerlink" title="10.用户管理"></a>10.用户管理</h2><h3 id="1-创建用户"><a href="#1-创建用户" class="headerlink" title="1. 创建用户"></a>1. 创建用户</h3><p>命令格式: <code>etcdctl user add &lt;用户名&gt;</code></p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl user add test_user
# 输入密码和确认密码
Password of test_user: 
Type password of test_user again for confirmation: 
User test_user created<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="2-删除用户"><a href="#2-删除用户" class="headerlink" title="2. 删除用户"></a>2. 删除用户</h3><p>命令格式: <code>etcdctl user del &lt;用户名&gt;</code></p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl user del test_user
User test_user deleted<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="3-修改用户密码"><a href="#3-修改用户密码" class="headerlink" title="3. 修改用户密码"></a>3. 修改用户密码</h3><p>命令格式: <code>etcdctl user passwd &lt;要修改的用户名&gt;</code></p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl user passwd test_user
Password of test_user: 
Type password of test_user again for confirmation: 
Password updated<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="4-查看用户列表"><a href="#4-查看用户列表" class="headerlink" title="4. 查看用户列表"></a>4. 查看用户列表</h3><pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl user list
root
test_user<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="5-查看用户的角色"><a href="#5-查看用户的角色" class="headerlink" title="5. 查看用户的角色"></a>5. 查看用户的角色</h3><p>命令格式: <code>etcdctl user get &lt;用户名&gt;</code></p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl user get root
User: root
Roles: root<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="11-角色管理"><a href="#11-角色管理" class="headerlink" title="11.角色管理"></a>11.角色管理</h2><h3 id="1-创建角色"><a href="#1-创建角色" class="headerlink" title="1. 创建角色"></a>1. 创建角色</h3><p>命令格式: <code>etcdctl role add &lt;角色名&gt;</code></p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl role add test_user_role
Role test_user_role created<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="2-设置角色权限"><a href="#2-设置角色权限" class="headerlink" title="2. 设置角色权限"></a>2. 设置角色权限</h3><p>命令格式: <code>etcdctl role grant-permission [角色名] [read|write|readwrite] [key]</code></p>
<p>如下命令: 为<code>test_user_role</code>角色授予对<code>/user</code>数据的<code>readwrite</code>(读写权限).</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl role grant-permission test_user_role readwrite /user
Role test_user_role updated<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="3-撤销角色权限"><a href="#3-撤销角色权限" class="headerlink" title="3. 撤销角色权限"></a>3. 撤销角色权限</h3><p>命令格式: <code>etcdctl role revoke-permission [角色名] [key]</code></p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl role revoke-permission test_user_role /user
Permission of key /user is revoked from role test_user_role<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="4-删除角色"><a href="#4-删除角色" class="headerlink" title="4. 删除角色"></a>4. 删除角色</h3><p>命令格式: <code>etcdctl role del [角色名]</code></p>
<h3 id="5-查询角色列表"><a href="#5-查询角色列表" class="headerlink" title="5. 查询角色列表"></a>5. 查询角色列表</h3><p>命令格式: <code>etcdctl role list</code></p>
<h3 id="6-角色与用户绑定"><a href="#6-角色与用户绑定" class="headerlink" title="6. 角色与用户绑定"></a>6. 角色与用户绑定</h3><p>命令格式: <code>etcdctl user grant-role [用户名] [角色名]</code></p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">% etcdctl user grant-role test_user test_user_role
Role test_user_role is granted to user test_user<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="7-角色与用户解除绑定"><a href="#7-角色与用户解除绑定" class="headerlink" title="7. 角色与用户解除绑定"></a>7. 角色与用户解除绑定</h3><p>命令格式: <code>etcdctl user revoke-role [用户名] [角色名]</code></p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh"> % etcdctl user revoke-role test_user test_user_role
Role test_user_role is revoked from user test_user<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>集群环境下管理</strong></p>
<p>如果时在集群环境下执行权限相关的命令式,则需要加上<code>--endpoints=ip1:12379,ip2:12379,ip3:12379</code></p>
<p>如开启集群环境权限管理:</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">etcdctl auth enable --endpoints=localhost:12379,localhost:22379,localhost:32379<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>添加用户</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">etcdctl user add test --endpoints=localhost:12379,localhost:22379,localhost:32379<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>集群环境下并且开启了权限管理,添加数据:</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">etcdctl put /test/data --endpoints=localhost:12379,localhost:22379,localhost:32379 --user=root<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="12-串行读与线性读"><a href="#12-串行读与线性读" class="headerlink" title="12.串行读与线性读"></a>12.串行读与线性读</h2><h3 id="1-串行读"><a href="#1-串行读" class="headerlink" title="1. 串行读"></a>1. 串行读</h3><p>串行读是直接读取当前节点状态机的数据,不需要Raft协议与集群进行交互,具有低延迟、高吞吐量的特点,适合对数据一致性要求不高的场景。</p>
<h3 id="2-线性读"><a href="#2-线性读" class="headerlink" title="2. 线性读"></a>2. 线性读</h3><p><strong>etcd默认的就是线性读</strong>,需要经过Raft协议,读取的是所有集群节点一致的数据,因此在延迟和吞吐量上略差于串行读。适合对数据一致性要求较高的场景。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://zlx2019.github.io">Zero</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://zlx2019.github.io/2023/02/11/etcd%E7%9A%84%E4%BD%BF%E7%94%A8/">https://zlx2019.github.io/2023/02/11/etcd%E7%9A%84%E4%BD%BF%E7%94%A8/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://zlx2019.github.io" target="_blank">Zero(˶˚ ᗨ ˚˶)</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a><a class="post-meta__tags" href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/">中间件</a></div><div class="post_share"><div class="social-share" data-image="https://movies-bucket.oss-cn-beijing.aliyuncs.com/95443c0654a7422fa17e4da7a1e6c493.jpeg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/reward/wechat.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/reward/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/reward/alipay.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/reward/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/02/11/Go%E3%80%90%E5%8D%81%E5%9B%9B%E3%80%91%E4%BC%98%E9%9B%85%E5%85%B3%E9%97%ADhttp%E6%9C%8D%E5%8A%A1/" title="Go【十四】优雅关闭http服务"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/logo/Go-logo6.png" onerror="onerror=null;src='/img/loadError.jpeg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Go【十四】优雅关闭http服务</div></div></a></div><div class="next-post pull-right"><a href="/2023/02/01/SpringBoot3%E3%80%90%E4%B8%80%E3%80%91Native/" title="SpringBoot3【一】Native"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/logo/spring-logo4.png" onerror="onerror=null;src='/img/loadError.jpeg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">SpringBoot3【一】Native</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/07/12/Quarkus%E3%80%90%E4%B8%80%E3%80%91%E7%AE%80%E8%BF%B0/" title="Quarkus【一】简述"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://movies-bucket.oss-cn-beijing.aliyuncs.com/5bc57fcd37e142589c8e72351700e8c3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-12</div><div class="title">Quarkus【一】简述</div></div></a></div><div><a href="/2022/07/13/Quarkus%E3%80%90%E4%B8%89%E3%80%91%E6%9E%84%E5%BB%BA%E4%BC%A0%E7%BB%9FWeb%E6%9C%8D%E5%8A%A1/" title="Quarkus【三】构建传统Web服务"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://movies-bucket.oss-cn-beijing.aliyuncs.com/95443c0654a7422fa17e4da7a1e6c493.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-13</div><div class="title">Quarkus【三】构建传统Web服务</div></div></a></div><div><a href="/2022/07/13/Quarkus%E3%80%90%E4%BA%8C%E3%80%91%E9%85%8D%E7%BD%AE%E9%A1%B9/" title="Quarkus【二】配置项"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://movies-bucket.oss-cn-beijing.aliyuncs.com/5bc57fcd37e142589c8e72351700e8c3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-13</div><div class="title">Quarkus【二】配置项</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Zero</div><div class="author-info__description">去码头搞点薯条吧\(^o^)/~</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">104</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">61</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">37</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/zlx2019"><i class="fab fa-github"></i><span>前往Github</span></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://res.abeim.cn/api/qq/?qq=1143967454" target="_blank" title="QQ"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-QQ"></use></svg></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/397253487" target="_blank" title="BiliBili"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-bilibili"></use></svg></a><a class="social-icon faa-parent animated-hover" href="https://github.com/zlx2019" target="_blank" title="Github"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-github"></use></svg></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#etcd%E5%AD%A6%E4%B9%A0%E7%AF%87%E7%AB%A0"><span class="toc-text">etcd学习篇章</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-etcd%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">1. etcd是什么?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-etcd%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-text">2. etcd的特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-etcd%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text">3. etcd使用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-etcd%E4%B8%8Ezk%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text">4. etcd与zk的区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-etcd%E7%9A%84%E5%AE%89%E8%A3%85"><span class="toc-text">5. etcd的安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%8D%95%E8%8A%82%E7%82%B9%E5%AE%89%E8%A3%85"><span class="toc-text">1. 单节点安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%8D%95%E6%9C%BA%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2"><span class="toc-text">2. 单机集群部署</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C"><span class="toc-text">6. 基础数据操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#help"><span class="toc-text">help</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AEK-V%E6%95%B0%E6%8D%AE"><span class="toc-text">设置K-V数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96K-V%E6%95%B0%E6%8D%AE"><span class="toc-text">读取K-V数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4K-V%E6%95%B0%E6%8D%AE"><span class="toc-text">删除K-V数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-Watch%E7%9B%91%E5%90%AC"><span class="toc-text">7. Watch监听</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-Lease%E7%A7%9F%E7%BA%A6"><span class="toc-text">8. Lease租约</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E7%A7%9F%E7%BA%A6"><span class="toc-text">1. 创建租约</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%9F%A5%E7%9C%8B%E7%A7%9F%E7%BA%A6%E4%BF%A1%E6%81%AF"><span class="toc-text">2. 查看租约信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%9F%A5%E7%9C%8B%E6%9C%89%E6%95%88%E7%9A%84%E7%A7%9F%E7%BA%A6%E5%88%97%E8%A1%A8"><span class="toc-text">3. 查看有效的租约列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%BD%BF%E7%94%A8%E7%A7%9F%E7%BA%A6"><span class="toc-text">4. 使用租约</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%92%A4%E9%94%80%E7%A7%9F%E7%BA%A6"><span class="toc-text">5. 撤销租约</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%88%B7%E6%96%B0%E7%A7%9F%E7%BA%A6"><span class="toc-text">5. 刷新租约</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="toc-text">9. 权限管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%9D%83%E9%99%90%E7%8A%B6%E6%80%81"><span class="toc-text">1. 权限状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%BC%80%E5%90%AF%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="toc-text">2. 开启权限管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%85%B3%E9%97%AD%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="toc-text">3. 关闭权限管理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86"><span class="toc-text">10.用户管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7"><span class="toc-text">1. 创建用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7"><span class="toc-text">2. 删除用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81"><span class="toc-text">3. 修改用户密码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%9F%A5%E7%9C%8B%E7%94%A8%E6%88%B7%E5%88%97%E8%A1%A8"><span class="toc-text">4. 查看用户列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%9F%A5%E7%9C%8B%E7%94%A8%E6%88%B7%E7%9A%84%E8%A7%92%E8%89%B2"><span class="toc-text">5. 查看用户的角色</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E8%A7%92%E8%89%B2%E7%AE%A1%E7%90%86"><span class="toc-text">11.角色管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E8%A7%92%E8%89%B2"><span class="toc-text">1. 创建角色</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%AE%BE%E7%BD%AE%E8%A7%92%E8%89%B2%E6%9D%83%E9%99%90"><span class="toc-text">2. 设置角色权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%92%A4%E9%94%80%E8%A7%92%E8%89%B2%E6%9D%83%E9%99%90"><span class="toc-text">3. 撤销角色权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%88%A0%E9%99%A4%E8%A7%92%E8%89%B2"><span class="toc-text">4. 删除角色</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%9F%A5%E8%AF%A2%E8%A7%92%E8%89%B2%E5%88%97%E8%A1%A8"><span class="toc-text">5. 查询角色列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E8%A7%92%E8%89%B2%E4%B8%8E%E7%94%A8%E6%88%B7%E7%BB%91%E5%AE%9A"><span class="toc-text">6. 角色与用户绑定</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E8%A7%92%E8%89%B2%E4%B8%8E%E7%94%A8%E6%88%B7%E8%A7%A3%E9%99%A4%E7%BB%91%E5%AE%9A"><span class="toc-text">7. 角色与用户解除绑定</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-%E4%B8%B2%E8%A1%8C%E8%AF%BB%E4%B8%8E%E7%BA%BF%E6%80%A7%E8%AF%BB"><span class="toc-text">12.串行读与线性读</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%B8%B2%E8%A1%8C%E8%AF%BB"><span class="toc-text">1. 串行读</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%BA%BF%E6%80%A7%E8%AF%BB"><span class="toc-text">2. 线性读</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/03/17/Rust%E3%80%90%E5%9B%9B%E3%80%91%E7%BB%93%E6%9E%84%E4%BD%93/" title="Rust【四】结构体"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/logo/Rust-logo1.png" onerror="this.onerror=null;this.src='/img/loadError.jpeg'" alt="Rust【四】结构体"/></a><div class="content"><a class="title" href="/2023/03/17/Rust%E3%80%90%E5%9B%9B%E3%80%91%E7%BB%93%E6%9E%84%E4%BD%93/" title="Rust【四】结构体">Rust【四】结构体</a><time datetime="2023-03-17T12:10:50.000Z" title="发表于 2023-03-17 20:10:50">2023-03-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/03/17/Rust%E3%80%90%E4%B8%89%E3%80%91%E5%88%87%E7%89%87/" title="Rust【三】切片"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/logo/Rust-logo1.png" onerror="this.onerror=null;this.src='/img/loadError.jpeg'" alt="Rust【三】切片"/></a><div class="content"><a class="title" href="/2023/03/17/Rust%E3%80%90%E4%B8%89%E3%80%91%E5%88%87%E7%89%87/" title="Rust【三】切片">Rust【三】切片</a><time datetime="2023-03-17T07:35:16.000Z" title="发表于 2023-03-17 15:35:16">2023-03-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/03/15/Rust%E3%80%90%E4%BA%8C%E3%80%91%E6%89%80%E6%9C%89%E6%9D%83/" title="Rust【二】所有权"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/logo/Rust-logo1.png" onerror="this.onerror=null;this.src='/img/loadError.jpeg'" alt="Rust【二】所有权"/></a><div class="content"><a class="title" href="/2023/03/15/Rust%E3%80%90%E4%BA%8C%E3%80%91%E6%89%80%E6%9C%89%E6%9D%83/" title="Rust【二】所有权">Rust【二】所有权</a><time datetime="2023-03-15T07:41:29.000Z" title="发表于 2023-03-15 15:41:29">2023-03-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/03/13/Kotlin%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/" title="Kotlin基础入门"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/logo/kotlin-logo2.png" onerror="this.onerror=null;this.src='/img/loadError.jpeg'" alt="Kotlin基础入门"/></a><div class="content"><a class="title" href="/2023/03/13/Kotlin%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/" title="Kotlin基础入门">Kotlin基础入门</a><time datetime="2023-03-13T13:58:14.903Z" title="发表于 2023-03-13 21:58:14">2023-03-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/03/10/Postgresql%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%97%85%E3%80%90%E5%85%AD%E3%80%91PLSql/" title="Postgresql学习之旅【六】PLSql"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://movies-bucket.oss-cn-beijing.aliyuncs.com/5bc57fcd37e142589c8e72351700e8c3.jpg" onerror="this.onerror=null;this.src='/img/loadError.jpeg'" alt="Postgresql学习之旅【六】PLSql"/></a><div class="content"><a class="title" href="/2023/03/10/Postgresql%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%97%85%E3%80%90%E5%85%AD%E3%80%91PLSql/" title="Postgresql学习之旅【六】PLSql">Postgresql学习之旅【六】PLSql</a><time datetime="2023-03-10T04:55:20.000Z" title="发表于 2023-03-10 12:55:20">2023-03-10</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 By Zero</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><script async src="//at.alicdn.com/t/c/font_3947604_e9n2fdfc2vi.js"></script><div class="aplayer no-destroy" data-id="2615711993" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="false"> </div><script async src="https://cdn1.tianli0.top/npm/vue@2.6.14/dist/vue.min.js"></script><script async src="https://cdn1.tianli0.top/npm/element-ui@2.15.6/lib/index.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v6.2.0" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="主题版本Butterfly_v4.3.1" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" data-title="本站采用多线部署，主线路托管于Vercel" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Hosted-Vercel-brightgreen?style=flat&amp;logo=Vercel" alt=""/></a><a class="github-badge" target="_blank" href="https://dashboard.4everland.org/" style="margin-inline:5px" data-title="本站采用多线部署，备用线路托管于4EVERLAND" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Hosted-4EVERLAND-22DDDD?style=flat&amp;logo=IPFS" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></p>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script async src="https://npm.elemecdn.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.js"></script><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><script data-pjax src="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.js"></script><script data-pjax>
  function gitcalendar_injector_config(){
      var parent_div_git = document.getElementById('gitZone');
      var item_html = '<div class="recent-post-item" id="gitcalendarBar" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 280px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animatetransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animatetransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>';
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      console.log('已挂载gitcalendar')
      }

    if( document.getElementById('gitZone') && (location.pathname ==='/about/'|| '/about/' ==='all')){
        gitcalendar_injector_config()
        GitCalendarInit("https://gitcalendar.fomal.cc/api?zlx2019",['#d9e0df', '#c6e0dc', '#a8dcd4', '#9adcd2', '#89ded1', '#77e0d0', '#5fdecb', '#47dcc6', '#39dcc3', '#1fdabe', '#00dab9'],'zlx2019')
    }
  </script><!-- hexo injector body_end end --></body></html>