<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Kubernetes开篇 | Zero(˶˚ ᗨ ˚˶)</title><meta name="author" content="Zero"><meta name="copyright" content="Zero"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="简介 Kubernnetes也称之为k8s,是一个可移植、可扩展的开源平台，用于管理容器化的工作负载和服务，可促进声明式配置和自动化。Kubernetes 拥有一个庞大且快速增长的生态，其服务、支持和工具的使用范围相当广泛。  Kubernetes 这个名字源于希腊语，意为舵手或飞行员。k8s 这个缩写是因为k和s之间有八个字符的关系。Google在2014年开源了Kubernetes项目。Ku">
<meta property="og:type" content="article">
<meta property="og:title" content="Kubernetes开篇">
<meta property="og:url" content="https://zlx2019.github.io/article/474f3ce3.html">
<meta property="og:site_name" content="Zero(˶˚ ᗨ ˚˶)">
<meta property="og:description" content="简介 Kubernnetes也称之为k8s,是一个可移植、可扩展的开源平台，用于管理容器化的工作负载和服务，可促进声明式配置和自动化。Kubernetes 拥有一个庞大且快速增长的生态，其服务、支持和工具的使用范围相当广泛。  Kubernetes 这个名字源于希腊语，意为舵手或飞行员。k8s 这个缩写是因为k和s之间有八个字符的关系。Google在2014年开源了Kubernetes项目。Ku">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://zlx2019.github.io/img/logo/k8s-logo6.png">
<meta property="article:published_time" content="2023-05-20T12:09:01.000Z">
<meta property="article:modified_time" content="2023-06-12T11:07:05.540Z">
<meta property="article:author" content="Zero">
<meta property="article:tag" content="Kubernetes">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zlx2019.github.io/img/logo/k8s-logo6.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://zlx2019.github.io/article/474f3ce3.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-right"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Kubernetes开篇',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-06-12 19:07:05'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/element-ui@2.15.6/packages/theme-chalk/lib/index.css"><link rel="stylesheet" href="/css/bcustom.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"/>
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">135</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">57</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">38</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><i class="fa-fw icon-home"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-home"></use></svg><span> 首页</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/archives/"><i class="fa-fw icon-rili"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-rili"></use></svg><span> 归档</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/tags/"><i class="fa-fw icon-biaoqian"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-biaoqian"></use></svg><span> 标签</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/categories/"><i class="fa-fw icon-fenlei"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-fenlei"></use></svg><span> 分类</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><i class="fa-fw fas fa-list faa-tada"></i><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-yinle"></use></svg><span> 音乐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/movies/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-bilibili"></use></svg><span> 视频</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/link/"><i class="fa-fw icon-zuopinzhanshi"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-zuopinzhanshi"></use></svg><span> 个人项目</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><i class="fa-fw icon-guanyuwo"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-guanyuwo"></use></svg><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/logo/k8s-logo6.png')"><nav id="nav"><span id="blog-info"><a href="/" title="Zero(˶˚ ᗨ ˚˶)"><span class="site-name">Zero(˶˚ ᗨ ˚˶)</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><i class="fa-fw icon-home"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-home"></use></svg><span> 首页</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/archives/"><i class="fa-fw icon-rili"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-rili"></use></svg><span> 归档</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/tags/"><i class="fa-fw icon-biaoqian"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-biaoqian"></use></svg><span> 标签</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/categories/"><i class="fa-fw icon-fenlei"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-fenlei"></use></svg><span> 分类</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><i class="fa-fw fas fa-list faa-tada"></i><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-yinle"></use></svg><span> 音乐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/movies/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-bilibili"></use></svg><span> 视频</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/link/"><i class="fa-fw icon-zuopinzhanshi"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-zuopinzhanshi"></use></svg><span> 个人项目</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><i class="fa-fw icon-guanyuwo"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-guanyuwo"></use></svg><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Kubernetes开篇</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-05-20T12:09:01.000Z" title="发表于 2023-05-20 20:09:01">2023-05-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-06-12T11:07:05.540Z" title="更新于 2023-06-12 19:07:05">2023-06-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Kubernetes/">Kubernetes</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">12.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>50分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Kubernetes开篇"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/logo/k8s-logo7.png" style="zoom:40%;"></p>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a><u><em>简介</em></u></h1><blockquote>
<p><a target="_blank" rel="noopener" href="https://kubernetes.io/">Kubernnetes</a>也称之为<strong>k8s</strong>,是一个可移植、可扩展的开源平台，用于管理容器化的工作负载和服务，可促进声明式配置和自动化。Kubernetes 拥有一个庞大且快速增长的生态，其服务、支持和工具的使用范围相当广泛。</p>
</blockquote>
<p><strong>Kubernetes</strong> 这个名字源于希腊语，意为<code>舵手</code>或<code>飞行员</code>。<strong>k8s</strong> 这个缩写是因为k和s之间有八个字符的关系。Google在2014年开源了<strong>Kubernetes</strong>项目。<strong>Kubernetes</strong>建立在 <a target="_blank" rel="noopener" href="https://research.google/pubs/pub43438">Google 大规模运行生产工作负载十几年经验</a>的基础上,结合了社区中最优秀的想法和实践。</p>
<p> <strong>简单来说</strong>: <strong>Kubernetes</strong>是一个开源的容器编排系统。</p>
<hr>

<h2 id="K8s存在的意义"><a href="#K8s存在的意义" class="headerlink" title="K8s存在的意义?"></a><em><u>K8s存在的意义?</u></em></h2><p>从早期的互联网时代,到如今的云原生时代,大致分为三个时代如下图所示:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/common/为什么需要k8s.svg"></p>
<p><strong>传统部署时代：</strong></p>
<p>早期，各个组织是在物理服务器上运行应用程序。<code>由于无法限制在物理服务器中运行的应用程序资源使用，因此会导致资源分配问题</code>。 例如，如果在同一台物理服务器上运行多个应用程序， 则可能会出现一个应用程序占用大部分资源的情况，而导致其他应用程序的性能下降。 <code>一种解决方案是将每个应用程序都运行在不同的物理服务器上， 但是当某个应用程式资源利用率不高时，剩余资源无法被分配给其他应用程式， 而且维护许多物理服务器的成本很高</code>。</p>
<p><strong>虚拟化部署时代：</strong></p>
<p>因此，虚拟化技术被引入了。虚拟化技术允许你在单个物理服务器的 CPU 上运行多台虚拟机（VM）。 虚拟化能使应用程序在不同 VM 之间被彼此隔离，且能提供一定程度的安全性， 因为一个应用程序的信息不能被另一应用程序随意访问。</p>
<p>虚拟化技术能够更好地利用物理服务器的资源，并且因为可轻松地添加或更新应用程序， 而因此可以具有更高的可扩缩性，以及降低硬件成本等等的好处。 通过虚拟化，你可以将一组物理资源呈现为可丢弃的虚拟机集群。</p>
<p>每个 VM 是一台完整的计算机，在虚拟化硬件之上运行所有组件，包括其自己的操作系统。</p>
<p><strong>容器部署时代：</strong></p>
<p>容器类似于 VM，但是更宽松的隔离特性，使容器之间可以共享操作系统（OS）。 因此，容器比起 VM 被认为是更轻量级的。且与 VM 类似，每个容器都具有自己的文件系统、CPU、内存、进程空间等。 由于它们与基础架构分离，因此可以跨云和 OS 发行版本进行移植。</p>
<p>容器因具有许多优势而变得流行起来，例如：</p>
<ul>
<li>敏捷应用程序的创建和部署：与使用 VM 镜像相比，提高了容器镜像创建的简便性和效率。</li>
<li>持续开发、集成和部署：通过快速简单的回滚（由于镜像不可变性）， 提供可靠且频繁的容器镜像构建和部署。</li>
<li>关注开发与运维的分离：在构建、发布时创建应用程序容器镜像，而不是在部署时， 从而将应用程序与基础架构分离。</li>
<li>可观察性：不仅可以显示 OS 级别的信息和指标，还可以显示应用程序的运行状况和其他指标信号。</li>
<li>跨开发、测试和生产的环境一致性：在笔记本计算机上也可以和在云中运行一样的应用程序。</li>
<li>跨云和操作系统发行版本的可移植性：可在 Ubuntu、RHEL、CoreOS、本地、 Google Kubernetes Engine 和其他任何地方运行。</li>
<li>以应用程序为中心的管理：提高抽象级别，从在虚拟硬件上运行 OS 到使用逻辑资源在 OS 上运行应用程序。</li>
<li>松散耦合、分布式、弹性、解放的微服务：应用程序被分解成较小的独立部分， 并且可以动态部署和管理 - 而不是在一台大型单机上整体运行。</li>
<li>资源隔离：可预测的应用程序性能。</li>
<li>资源利用：高效率和高密度。</li>
</ul>
<hr>

<h2 id="K8s能做什么"><a href="#K8s能做什么" class="headerlink" title="K8s能做什么?"></a><em><u>K8s能做什么?</u></em></h2><p>容器是打包和运行应用程序的好方式。在生产环境中， 你需要管理运行着应用程序的容器，并确保服务不会下线。 例如，如果一个容器发生故障，则你需要启动另一个容器。 如果此行为交由给系统处理，是不是会更容易一些？</p>
<p>这就是 <strong>Kubernetes</strong> 要来做的事情！ <strong>Kubernetes</strong> 为你提供了一个可弹性运行分布式系统的框架。 <strong>Kubernetes</strong> 会满足你的扩展要求、故障转移你的应用、提供部署模式等。 例如，<strong>Kubernetes</strong> 可以轻松管理系统的 Canary (金丝雀) 部署。</p>
<p>K8s提供如下功能:</p>
<ul>
<li><p><strong>服务发现和负载均衡</strong></p>
<p>Kubernetes 可以使用 DNS 名称或自己的 IP 地址来暴露容器。 如果进入容器的流量很大， Kubernetes 可以负载均衡并分配网络流量，从而使部署稳定。</p>
</li>
<li><p><strong>存储编排</strong></p>
<p>Kubernetes 允许你自动挂载你选择的存储系统，例如本地存储、公共云提供商等。</p>
</li>
<li><p><strong>自动部署和回滚</strong></p>
<p>你可以使用 Kubernetes 描述已部署容器的所需状态， 它可以以受控的速率将实际状态更改为期望状态。 例如，你可以自动化 Kubernetes 来为你的部署创建新容器， 删除现有容器并将它们的所有资源用于新容器。</p>
</li>
<li><p><strong>自动完成装箱计算</strong></p>
<p>你为 Kubernetes 提供许多节点组成的集群，在这个集群上运行容器化的任务。 你告诉 Kubernetes 每个容器需要多少 CPU 和内存 (RAM)。 Kubernetes 可以将这些容器按实际情况调度到你的节点上，以最佳方式利用你的资源。</p>
</li>
<li><p><strong>自我修复</strong></p>
<p>Kubernetes 将重新启动失败的容器、替换容器、杀死不响应用户定义的运行状况检查的容器， 并且在准备好服务之前不将其通告给客户端。</p>
</li>
<li><p><strong>密钥与配置管理</strong></p>
<p>Kubernetes 允许你存储和管理敏感信息，例如密码、OAuth 令牌和 ssh 密钥。 你可以在不重建容器镜像的情况下部署和更新密钥和应用程序配置，也无需在堆栈配置中暴露密钥。</p>
</li>
</ul>
<hr>

<h1 id="架构组件"><a href="#架构组件" class="headerlink" title="架构组件"></a><em><u>架构组件</u></em></h1><p>一个<strong>K8s</strong>集群主要分为两种节点角色: <strong>控制平面(Control Plane)</strong>与<strong>工作节点(Work Node)</strong>，也就是所谓的主从节点模型。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/common/k8s组件介绍.svg"></p>
<p>上图就是一个Kubernetes集群所需的各种组件。</p>
<h2 id="Control-Plane"><a href="#Control-Plane" class="headerlink" title="Control Plane"></a><em><u>Control Plane</u></em></h2><p>图中左侧的<code>Control Plane</code>组件就是集群的<strong>控制节点</strong>,你可以理解为<strong>集群主节点</strong>。主要负责管理和调度<strong>工作节点</strong>。例如: 为集群做出全局决策，比如资源的调度。 以及检测和响应集群事件，例如当不满足部署的 <code>replicas</code> 字段时， 要启动新的 <a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/">pod</a>）。</p>
<p>控制平面组件可以在集群中的任何节点上运行。 然而，为了简单起见，设置脚本通常会在同一个计算机上启动所有控制平面组件， 并且不会在此计算机上运行用户容器。 请参阅<a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/high-availability/">使用 kubeadm 构建高可用性集群</a> 中关于跨多机器控制平面设置的示例。</p>
<ul>
<li><p><strong>api</strong></p>
<p>API 服务器是 Kubernetes <a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/reference/glossary/?all=true#term-control-plane">控制平面</a>的组件， 该组件负责公开了 Kubernetes API，负责处理接受请求的工作。 API 服务器是 Kubernetes 控制平面的前端。</p>
<p>Kubernetes API 服务器的主要实现是 <a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/reference/command-line-tools-reference/kube-apiserver/">kube-apiserver</a>。 <code>kube-apiserver</code> 设计上考虑了水平扩缩，也就是说，它可通过部署多个实例来进行扩缩。 你可以运行 <code>kube-apiserver</code> 的多个实例，并在这些实例之间平衡流量。</p>
</li>
<li><p><strong>etcd</strong></p>
<p>一致且高可用的键值存储，用作 Kubernetes 所有集群数据的后台数据库。</p>
</li>
<li><p><strong>sched</strong></p>
<p><code>kube-scheduler</code> 是<a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/reference/glossary/?all=true#term-control-plane">控制平面</a>的组件， 负责监视新创建的、未指定运行<a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/concepts/architecture/nodes/">节点（node）</a>的 <a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/">Pods</a>， 并选择节点来让 Pod 在上面运行。</p>
<p>调度决策考虑的因素包括单个 Pod 及 Pods 集合的资源需求、软硬件及策略约束、 亲和性及反亲和性规范、数据位置、工作负载间的干扰及最后时限。</p>
</li>
<li><p><strong>cm</strong></p>
<p><a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/reference/command-line-tools-reference/kube-controller-manager/">kube-controller-manager</a>是<a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/reference/glossary/?all=true#term-control-plane">控制平面</a>的组件，负责运行<a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/concepts/architecture/controller/">控制器</a>进程。从逻辑上讲， 每个<a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/concepts/architecture/controller/">控制器</a>都是一个单独的进程， 但是为了降低复杂性，它们都被编译到同一个可执行文件，并在同一个进程中运行。</p>
<p>这些控制器包括：</p>
<ul>
<li>节点控制器（Node Controller）：负责在节点出现故障时进行通知和响应</li>
<li>任务控制器（Job Controller）：监测代表一次性任务的 Job 对象，然后创建 Pods 来运行这些任务直至完成</li>
<li>端点分片控制器（EndpointSlice controller）：填充端点分片（EndpointSlice）对象（以提供 Service 和 Pod 之间的链接）。</li>
<li>服务账号控制器（ServiceAccount controller）：为新的命名空间创建默认的服务账号(ServiceAccount)。</li>
</ul>
</li>
<li><p><strong>ccm</strong></p>
<p>一个 Kubernetes <a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/reference/glossary/?all=true#term-control-plane">控制平面</a>组件， 嵌入了特定于云平台的控制逻辑。 云控制器管理器（Cloud Controller Manager）允许你将你的集群连接到云提供商的 API 之上， 并将与该云平台交互的组件同与你的集群交互的组件分离开来。</p>
<p><code>cloud-controller-manager</code> 仅运行特定于云平台的控制器。 因此如果你在自己的环境中运行 Kubernetes，或者在本地计算机中运行学习环境， 所部署的集群不需要有云控制器管理器。</p>
<p>与 <code>kube-controller-manager</code> 类似，<code>cloud-controller-manager</code> 将若干逻辑上独立的控制回路组合到同一个可执行文件中， 供你以同一进程的方式运行。 你可以对其执行水平扩容（运行不止一个副本）以提升性能或者增强容错能力。</p>
<p>下面的控制器都包含对云平台驱动的依赖：</p>
<ul>
<li>节点控制器（Node Controller）：用于在节点终止响应后检查云提供商以确定节点是否已被删除</li>
<li>路由控制器（Route Controller）：用于在底层云基础架构中设置路由</li>
<li>服务控制器（Service Controller）：用于创建、更新和删除云提供商负载均衡器</li>
</ul>
</li>
</ul>
<h2 id="Node"><a href="#Node" class="headerlink" title="Node"></a><em><u>Node</u></em></h2><p>工作节点组件会在每个节点上运行，负责维护运行的Pod并提供Kubernetes运行环境。</p>
<ul>
<li><p><strong>kubelet</strong></p>
<p>kubelet 会在集群中每个<a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/concepts/architecture/nodes/">节点（node）</a>上运行。 它保证<a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/concepts/overview/what-is-kubernetes/#why-containers">容器（containers）</a>都运行在 <a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/">Pod</a> 中。</p>
<p>kubelet 接收一组通过各类机制提供给它的 PodSpecs， 确保这些 PodSpecs 中描述的容器处于运行状态且健康。 kubelet 不会管理不是由 Kubernetes 创建的容器。</p>
</li>
<li><p><strong>kube-proxy</strong></p>
<p><a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/reference/command-line-tools-reference/kube-proxy/">kube-proxy</a> 是集群中每个<a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/concepts/architecture/nodes/">节点（node）</a>上所运行的网络代理， 实现 Kubernetes <a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/">服务（Service）</a> 概念的一部分。</p>
<p>kube-proxy 维护节点上的一些网络规则， 这些网络规则会允许从集群内部或外部的网络会话与 Pod 进行网络通信。</p>
<p>如果操作系统提供了可用的数据包过滤层，则 kube-proxy 会通过它来实现网络规则。 否则，kube-proxy 仅做流量转发。</p>
</li>
<li><p><strong>Container Runtime</strong></p>
<p>容器运行环境,是负责运行容器的软件。</p>
<p>Kubernetes支持很多容器运行环境,例如Containerd、Docker、CRI-o以及Kubernetes CRI的其他任何实现。</p>
</li>
</ul>
<hr>

<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a><em><u>安装</u></em></h1><h2 id="1-minikubu-单节点"><a href="#1-minikubu-单节点" class="headerlink" title="1. minikubu(单节点)"></a><u><em>1. minikubu(单节点)</em></u></h2><p><strong>minikube</strong>是一个基于<strong>Docker的</strong> <strong>Kubernetes</strong>集群模拟器,只有一个节点的集群，一般用于学习和测试使用。<strong>控制节点</strong>和<strong>工作节点</strong>都安装在一个节点上。</p>
<p><strong>minikube</strong>是依赖于Docker的,所以我们需要先安装Docker。关于Docker的安装,请参考我的另一篇博客: <a href="http://zlx2019.github.io/article/210c580a.html">Docker安装</a></p>
<div class="tabs" id=""><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#-1">Desktop</button></li><li class="tab"><button type="button" data-href="#-2">Linux</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="-1"><p>如果你安装了Docker Desktop,可以直接通过Docker Desktop来安装，如下图:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/common/minikube-Mac安装.png"></p>
<p>将Enable Kubernetes勾选上,就会自动安装monikube。</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="-2"><p>参考地址: <a target="_blank" rel="noopener" href="https://minikube.sigs.k8s.io/docs/start/">minikube</a></p>
<ol>
<li><p>下载minikube的二进制安装程序</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-arm64<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>安装minikube</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">install</span> minikube-linux-arm64 /usr/local/bin/minikube<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
</ol>
<p>​    简单两步就把minikube安装完成辣~</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>
<p><strong>管理minikube</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 启动集群(非root用户)</span>
minikube start
<span class="token comment"># 启动集群,允许以root用户启动</span>
minikube start --force

<span class="token comment"># 暂停 Kubernetes 而不影响已部署的应用程序：</span>
minikube pause
<span class="token comment"># 取消暂停模式</span>
minikube unpause

<span class="token comment"># 停止集群</span>
minikube stop

<span class="token comment"># 删除所有minikube集群</span>
minikube delete --all

<span class="token comment"># 更改默认内存限制（需要重新启动）：</span>
minikube config <span class="token builtin class-name">set</span> memory <span class="token number">9001</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>启动集群后,查看节点信息:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ minikube kubectl get nodes

NAME       STATUS   ROLES           AGE     VERSION
minikube   Ready    control-plane   4m41s   v1.26.3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>为了方便使用,可以为<code>minikube kubectl</code>配置一个别名为<code>kubectl</code>,使用起来更简洁:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">alias</span> <span class="token assign-left variable">kubectl</span><span class="token operator">=</span><span class="token string">"minikube kubectl --"</span>

$ kubectl get nodes
NAME       STATUS   ROLES           AGE     VERSION
minikube   Ready    control-plane   7m27s   v1.26.3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>到此,minikube就安装完成了.</p>
<hr>

<h2 id="2-裸机集群安装"><a href="#2-裸机集群安装" class="headerlink" title="2. 裸机集群安装"></a><u><em>2. 裸机集群安装</em></u></h2><p><strong>环境准备</strong></p>
<ul>
<li>节点数量: 3台虚拟器 Centos7</li>
<li>硬件配置: 4GRAM、2个CPU、40G硬盘</li>
<li>网络配置: 节点之间网络互通,并且能够访问外网</li>
</ul>
<p><strong>集群规划</strong></p>
<ul>
<li>master IP: 192.168.0.110</li>
<li>node1  IP: 192.168.0.111</li>
<li>node2  IP: 192.168.0.112</li>
</ul>
<p>下面正式开始安装K8s集群</p>
<h3 id="1-同步hosts文件"><a href="#1-同步hosts文件" class="headerlink" title="1. 同步hosts文件"></a>1. 同步hosts文件</h3><p>在所有节点主机的<code>/etc/hosts</code>文件中添加如下内容:</p>
<p>所有节点的<code>主机名</code>与<code>IP</code>一一对应。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">&gt;&gt;</span> /etc/hosts <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
192.168.0.110 master
192.168.0.111 node1
192.168.0.112 node2
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>每个节点都需要执行该命令,然后可以在主节点上执行如下命令测试是否可以网络互通:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ping</span> node1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="2-关闭防火墙"><a href="#2-关闭防火墙" class="headerlink" title="2. 关闭防火墙"></a>2. 关闭防火墙</h3><p>关闭所有节点的防火墙</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl stop firewalld <span class="token operator">&amp;&amp;</span> systemctl disable firewalld<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="3-关闭swap分区"><a href="#3-关闭swap分区" class="headerlink" title="3. 关闭swap分区"></a>3. 关闭swap分区</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">swapoff -a <span class="token operator">&amp;&amp;</span> <span class="token function">sed</span> -ri <span class="token string">'s/.*swap.*/#&amp;/'</span> /etc/fstab<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="4-同步时间"><a href="#4-同步时间" class="headerlink" title="4. 同步时间"></a>4. 同步时间</h3><p>安装时间同步工具,让所有节点时间同步。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token function">install</span> ntpdate -y
ntpdate time.windows.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="5-安装Containerd"><a href="#5-安装Containerd" class="headerlink" title="5. 安装Containerd"></a>5. 安装Containerd</h3><p>安装容器运行时环境<code>Containerd</code>。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 安装 yum-config-manager 相关依赖</span>
$ yum <span class="token function">install</span> -y yum-utils device-mapper-persistent-data lvm2
<span class="token comment"># 添加 containerd yum 源</span>
$ yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
<span class="token comment"># 安装 containerd</span>
$ yum <span class="token function">install</span>  -y containerd.io cri-tools  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="6-配置Containerd"><a href="#6-配置Containerd" class="headerlink" title="6. 配置Containerd"></a>6. 配置Containerd</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 配置 containerd</span>
$ <span class="token function">cat</span> <span class="token operator">&gt;</span>  /etc/containerd/config.toml <span class="token operator">&lt;&lt;</span><span class="token string">EOF
disabled_plugins = ["restart"]
[plugins.linux]
shim_debug = true
[plugins.cri.registry.mirrors."docker.io"]
endpoint = ["https://frz7i079.mirror.aliyuncs.com"]
[plugins.cri]
sandbox_image = "registry.aliyuncs.com/google_containers/pause:3.2"
EOF</span>

<span class="token comment"># 启动 containerd 服务 并 开机配置自启动</span>
$ systemctl <span class="token builtin class-name">enable</span> containerd <span class="token operator">&amp;&amp;</span> systemctl start containerd <span class="token operator">&amp;&amp;</span> systemctl status containerd 

<span class="token comment"># 配置 containerd 配置</span>
$ <span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/modules-load.d/containerd.conf <span class="token operator">&lt;&lt;</span><span class="token string">EOF
overlay
br_netfilter
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="7-配置k8s网络配置"><a href="#7-配置k8s网络配置" class="headerlink" title="7. 配置k8s网络配置"></a>7. 配置k8s网络配置</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 配置 k8s 网络配置</span>
$ <span class="token function">cat</span>  <span class="token operator">&gt;</span> /etc/sysctl.d/k8s.conf <span class="token operator">&lt;&lt;</span><span class="token string">EOF
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
net.ipv4.ip_forward = 1
EOF</span>

<span class="token comment"># 加载 overlay br_netfilter 模块</span>
$ modprobe overlay
$ modprobe br_netfilter

<span class="token comment"># 查看当前配置是否生效</span>
$ sysctl -p /etc/sysctl.d/k8s.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="9-重启所有节点"><a href="#9-重启所有节点" class="headerlink" title="9. 重启所有节点"></a>9. 重启所有节点</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">reboot</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="10-安装k8s"><a href="#10-安装k8s" class="headerlink" title="10. 安装k8s"></a>10. 安装k8s</h3><ol>
<li><p>添加k8s源</p>
<p><strong>x86架构源</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> kubernetes.repo</span>
[kubernetes]
name=Kubernetes
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=0
repo_gpgcheck=0
gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
EOF</span>


<span class="token comment"># 将源移动到对应目录中</span>
$ <span class="token function">mv</span> kubernetes.repo /etc/yum.repos.d/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>ARM架构源</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> kubernetes.repo </span>
[kubernetes]
name=Kubernetes
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-aarch64
enabled=1
gpgcheck=0
repo_gpgcheck=0
gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
EOF</span>

<span class="token comment"># 将源移动到对应目录中</span>
$ <span class="token function">mv</span> kubernetes.repo /etc/yum.repos.d/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查看源</p>
<p>根据不同的系统架构设置不同的源之后,查看源:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># yum repolist</span>
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
kubernetes                                                                                              <span class="token operator">|</span> <span class="token number">1.4</span> kB  00:00:00     
kubernetes/primary                                                                                      <span class="token operator">|</span> <span class="token number">131</span> kB  00:00:00     
kubernetes                                                                                                             <span class="token number">968</span>/968
repo <span class="token function">id</span>                                                    repo name                                                     status
base/7/x86_64                                              CentOS-7 - Base - <span class="token number">163</span>.com                                     <span class="token number">10,072</span>
docker-ce-stable/7/x86_64                                  Docker CE Stable - x86_64                                        <span class="token number">241</span>
extras/7/x86_64                                            CentOS-7 - Extras - <span class="token number">163</span>.com                                      <span class="token number">515</span>
kubernetes                                                 Kubernetes                                                       <span class="token number">968</span>
updates/7/x86_64                                           CentOS-7 - Updates - <span class="token number">163</span>.com                                   <span class="token number">4,954</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>安装K8s</p>
<p>k8s的源安装完之后,接下来就可以正式安装k8s了</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 安装最新版本</span>
$ yum <span class="token function">install</span> -y kubelet kubeadm kubectl
<span class="token comment"># ||</span>
<span class="token comment"># 指定版本安装</span>
$ yum <span class="token function">install</span> -y kubelet-1.26.0 kubectl-1.26.0 kubeadm-1.26.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>启动kubelet</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 启动 kubelet</span>
$ <span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> kubelet <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> systemctl start kubelet <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> systemctl status kubelet

Created symlink from /etc/systemd/system/multi-user.target.wants/kubelet.service to /usr/lib/systemd/system/kubelet.service.
● kubelet.service - kubelet: The Kubernetes Node Agent
   Loaded: loaded <span class="token punctuation">(</span>/usr/lib/systemd/system/kubelet.service<span class="token punctuation">;</span> enabled<span class="token punctuation">;</span> vendor preset: disabled<span class="token punctuation">)</span>
  Drop-In: /usr/lib/systemd/system/kubelet.service.d
           └─10-kubeadm.conf
   Active: active <span class="token punctuation">(</span>running<span class="token punctuation">)</span> since Mon <span class="token number">2023</span>-05-22 <span class="token number">17</span>:56:38 CST<span class="token punctuation">;</span> 65ms ago
     Docs: https://kubernetes.io/docs/
 Main PID: <span class="token number">8250</span> <span class="token punctuation">(</span>kubelet<span class="token punctuation">)</span>
    Tasks: <span class="token number">5</span>
   Memory: <span class="token number">11</span>.5M
   CGroup: /system.slice/kubelet.service
           └─8250 /usr/bin/kubelet --bootstrap-kubeconfig<span class="token operator">=</span>/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig<span class="token operator">=</span>/etc/kubernetes/kubelet.conf --config<span class="token operator">=</span>/var/lib/kubelet/config<span class="token punctuation">..</span><span class="token punctuation">..</span>

May <span class="token number">22</span> <span class="token number">17</span>:56:38 master systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Started kubelet: The Kubernetes Node Agent.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ol>
<h3 id="11-初始化集群"><a href="#11-初始化集群" class="headerlink" title="11. 初始化集群"></a>11. 初始化集群</h3><p><strong><code>注意: 初始化 k8s 集群仅仅需要再在 master 节点进行集群初始化!</code></strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">kubeadm init <span class="token punctuation">\</span>
--apiserver-advertise-address<span class="token operator">=</span><span class="token number">192.168</span>.0.110 <span class="token punctuation">\</span>
--pod-network-cidr<span class="token operator">=</span><span class="token number">10.244</span>.0.0/16 <span class="token punctuation">\</span>
--image-repository registry.aliyuncs.com/google_containers<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>--apiserver-advertise-address</code>为主节点IP.</p>
<p><code>--pod-network-cidr</code> 参数是用于指定 Kubernetes 集群中 Pod 网络的 IP 地址范围。每个 Pod 在集群中都会被分配一个独立的 IP 地址，用于实现网络通信。</p>
<p>在主节点上初始化完成后,会得到如下信息:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Your Kubernetes control-plane has initialized successfully<span class="token operator">!</span>

To start using your cluster, you need to run the following as a regular user:

  <span class="token function">mkdir</span> -p <span class="token environment constant">$HOME</span>/.kube
  <span class="token function">sudo</span> <span class="token function">cp</span> -i /etc/kubernetes/admin.conf <span class="token environment constant">$HOME</span>/.kube/config
  <span class="token function">sudo</span> <span class="token function">chown</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -u<span class="token variable">)</span></span><span class="token builtin class-name">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -g<span class="token variable">)</span></span> <span class="token environment constant">$HOME</span>/.kube/config

Alternatively, <span class="token keyword">if</span> you are the root user, you can run:

  <span class="token builtin class-name">export</span> <span class="token assign-left variable">KUBECONFIG</span><span class="token operator">=</span>/etc/kubernetes/admin.conf

You should now deploy a pod network to the cluster.
Run <span class="token string">"kubectl apply -f [podnetwork].yaml"</span> with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/

Then you can <span class="token function">join</span> any number of worker nodes by running the following on each as root:

kubeadm <span class="token function">join</span> <span class="token number">192.168</span>.0.110:6443 --token g8id67.b8yqooz74o7gkuav <span class="token punctuation">\</span>
        --discovery-token-ca-cert-hash sha256:02ec0d71e7e8776d487971bbb89ce8b56150e25090b3e7c0e742667e45064155 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>如果你使用的是非<code>root</code>用户,建议执行如下指令:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> -p <span class="token environment constant">$HOME</span>/.kube
<span class="token function">sudo</span> <span class="token function">cp</span> -i /etc/kubernetes/admin.conf <span class="token environment constant">$HOME</span>/.kube/config
<span class="token function">sudo</span> <span class="token function">chown</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -u<span class="token variable">)</span></span><span class="token builtin class-name">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -g<span class="token variable">)</span></span> <span class="token environment constant">$HOME</span>/.kube/config<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>如果是<code>root</code>用户,直接执行这条命令也是可以的:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">KUBECONFIG</span><span class="token operator">=</span>/etc/kubernetes/admin.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>当前集群目前只有一个节点,那就是主节点:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get nodes</span>
NAME     STATUS     ROLES           AGE     VERSION
master   NotReady   control-plane   6m19s   v1.26.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>如果我们想将另外两个节点加入到此集群中,需要通过创建集群所生成的令牌,在<code>node1</code>和<code>node2</code>节点上执行如下命令即可:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">kubeadm <span class="token function">join</span> <span class="token number">192.168</span>.0.110:6443 --token g8id67.b8yqooz74o7gkuav <span class="token punctuation">\</span>
        --discovery-token-ca-cert-hash sha256:02ec0d71e7e8776d487971bbb89ce8b56150e25090b3e7c0e742667e45064155 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>然后再在<code>master</code>节点查看集群节点信息:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get nodes</span>
NAME     STATUS     ROLES           AGE   VERSION
master   NotReady   control-plane   10m   v1.26.0
node1    NotReady   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>          13s   v1.26.0
node2    NotReady   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>          17s   v1.26.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="12-配置网络插件"><a href="#12-配置网络插件" class="headerlink" title="12. 配置网络插件"></a>12. 配置网络插件</h3><p>只需要在<code>master</code>节点执行即可。</p>
<ol>
<li><p>创建<code>kube-flannel.yml</code></p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Namespace
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>flannel
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">pod-security.kubernetes.io/enforce</span><span class="token punctuation">:</span> privileged
<span class="token punctuation">---</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> flannel
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">""</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> pods
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> get
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">""</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> nodes
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> get
  <span class="token punctuation">-</span> list
  <span class="token punctuation">-</span> watch
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">""</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> nodes/status
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> patch
<span class="token punctuation">---</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRoleBinding
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> flannel
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
  <span class="token key atrule">name</span><span class="token punctuation">:</span> flannel
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
  <span class="token key atrule">name</span><span class="token punctuation">:</span> flannel
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>flannel
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> flannel
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>flannel
<span class="token punctuation">---</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>flannel<span class="token punctuation">-</span>cfg
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>flannel
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">tier</span><span class="token punctuation">:</span> node
    <span class="token key atrule">app</span><span class="token punctuation">:</span> flannel
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">cni-conf.json</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    {
      "name": "cbr0",
      "cniVersion": "0.3.1",
      "plugins": [
        {
          "type": "flannel",
          "delegate": {
            "hairpinMode": true,
            "isDefaultGateway": true
          }
        },
        {
          "type": "portmap",
          "capabilities": {
            "portMappings": true
          }
        }
      ]
    }</span>
  <span class="token key atrule">net-conf.json</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    {
      "Network": "10.244.0.0/16",
      "Backend": {
        "Type": "vxlan"
      }
    }</span>
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> DaemonSet
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>flannel<span class="token punctuation">-</span>ds
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>flannel
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">tier</span><span class="token punctuation">:</span> node
    <span class="token key atrule">app</span><span class="token punctuation">:</span> flannel
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> flannel
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">tier</span><span class="token punctuation">:</span> node
        <span class="token key atrule">app</span><span class="token punctuation">:</span> flannel
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">affinity</span><span class="token punctuation">:</span>
        <span class="token key atrule">nodeAffinity</span><span class="token punctuation">:</span>
          <span class="token key atrule">requiredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation">:</span>
            <span class="token key atrule">nodeSelectorTerms</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">matchExpressions</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> kubernetes.io/os
                <span class="token key atrule">operator</span><span class="token punctuation">:</span> In
                <span class="token key atrule">values</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> linux
      <span class="token key atrule">hostNetwork</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">priorityClassName</span><span class="token punctuation">:</span> system<span class="token punctuation">-</span>node<span class="token punctuation">-</span>critical
      <span class="token key atrule">tolerations</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">operator</span><span class="token punctuation">:</span> Exists
        <span class="token key atrule">effect</span><span class="token punctuation">:</span> NoSchedule
      <span class="token key atrule">serviceAccountName</span><span class="token punctuation">:</span> flannel
      <span class="token key atrule">initContainers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> install<span class="token punctuation">-</span>cni<span class="token punctuation">-</span>plugin
       <span class="token comment">#image: flannelcni/flannel-cni-plugin:v1.1.0 for ppc64le and mips64le (dockerhub limitations may apply)</span>
        <span class="token key atrule">image</span><span class="token punctuation">:</span> docker.io/rancher/mirrored<span class="token punctuation">-</span>flannelcni<span class="token punctuation">-</span>flannel<span class="token punctuation">-</span>cni<span class="token punctuation">-</span>plugin<span class="token punctuation">:</span>v1.1.0
        <span class="token key atrule">command</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> cp
        <span class="token key atrule">args</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token punctuation">-</span>f
        <span class="token punctuation">-</span> /flannel
        <span class="token punctuation">-</span> /opt/cni/bin/flannel
        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> cni<span class="token punctuation">-</span>plugin
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /opt/cni/bin
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> install<span class="token punctuation">-</span>cni
       <span class="token comment">#image: flannelcni/flannel:v0.20.2 for ppc64le and mips64le (dockerhub limitations may apply)</span>
        <span class="token key atrule">image</span><span class="token punctuation">:</span> docker.io/rancher/mirrored<span class="token punctuation">-</span>flannelcni<span class="token punctuation">-</span>flannel<span class="token punctuation">:</span>v0.20.2
        <span class="token key atrule">command</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> cp
        <span class="token key atrule">args</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token punctuation">-</span>f
        <span class="token punctuation">-</span> /etc/kube<span class="token punctuation">-</span>flannel/cni<span class="token punctuation">-</span>conf.json
        <span class="token punctuation">-</span> /etc/cni/net.d/10<span class="token punctuation">-</span>flannel.conflist
        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> cni
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/cni/net.d
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> flannel<span class="token punctuation">-</span>cfg
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/kube<span class="token punctuation">-</span>flannel/
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>flannel
       <span class="token comment">#image: flannelcni/flannel:v0.20.2 for ppc64le and mips64le (dockerhub limitations may apply)</span>
        <span class="token key atrule">image</span><span class="token punctuation">:</span> docker.io/rancher/mirrored<span class="token punctuation">-</span>flannelcni<span class="token punctuation">-</span>flannel<span class="token punctuation">:</span>v0.20.2
        <span class="token key atrule">command</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> /opt/bin/flanneld
        <span class="token key atrule">args</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>ip<span class="token punctuation">-</span>masq
        <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>kube<span class="token punctuation">-</span>subnet<span class="token punctuation">-</span>mgr
        <span class="token key atrule">resources</span><span class="token punctuation">:</span>
          <span class="token key atrule">requests</span><span class="token punctuation">:</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token string">"100m"</span>
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token string">"50Mi"</span>
          <span class="token key atrule">limits</span><span class="token punctuation">:</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token string">"100m"</span>
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token string">"50Mi"</span>
        <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>
          <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
          <span class="token key atrule">capabilities</span><span class="token punctuation">:</span>
            <span class="token key atrule">add</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"NET_ADMIN"</span><span class="token punctuation">,</span> <span class="token string">"NET_RAW"</span><span class="token punctuation">]</span>
        <span class="token key atrule">env</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> POD_NAME
          <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>
            <span class="token key atrule">fieldRef</span><span class="token punctuation">:</span>
              <span class="token key atrule">fieldPath</span><span class="token punctuation">:</span> metadata.name
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> POD_NAMESPACE
          <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>
            <span class="token key atrule">fieldRef</span><span class="token punctuation">:</span>
              <span class="token key atrule">fieldPath</span><span class="token punctuation">:</span> metadata.namespace
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> EVENT_QUEUE_DEPTH
          <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"5000"</span>
        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> run
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /run/flannel
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> flannel<span class="token punctuation">-</span>cfg
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/kube<span class="token punctuation">-</span>flannel/
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> xtables<span class="token punctuation">-</span>lock
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /run/xtables.lock
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> run
        <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> /run/flannel
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> cni<span class="token punctuation">-</span>plugin
        <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> /opt/cni/bin
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> cni
        <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> /etc/cni/net.d
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> flannel<span class="token punctuation">-</span>cfg
        <span class="token key atrule">configMap</span><span class="token punctuation">:</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>flannel<span class="token punctuation">-</span>cfg
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> xtables<span class="token punctuation">-</span>lock
        <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> /run/xtables.lock
          <span class="token key atrule">type</span><span class="token punctuation">:</span> FileOrCreate<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>执行该文件</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">kubectl apply -f kube-flannel.yml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>然后等待一段时间,等待插件安装完成</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># watch -n 1 -d kubectl get pods -A</span>
NAMESPACE      NAME                             READY   STATUS     RESTARTS   AGE
kube-flannel   kube-flannel-ds-rcchd            <span class="token number">0</span>/1     Init:0/2   <span class="token number">0</span>          38s
kube-flannel   kube-flannel-ds-sxgxl            <span class="token number">0</span>/1     Init:0/2   <span class="token number">0</span>          38s
kube-flannel   kube-flannel-ds-xvrq6            <span class="token number">0</span>/1     Init:0/2   <span class="token number">0</span>          38s
<span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ol>
<h3 id="13-查看集群状态"><a href="#13-查看集群状态" class="headerlink" title="13. 查看集群状态"></a>13. 查看集群状态</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -A</span>
NAMESPACE      NAME                             READY   STATUS    RESTARTS       AGE
kube-flannel   kube-flannel-ds-rcchd            <span class="token number">1</span>/1     Running   <span class="token number">0</span>              21m
kube-flannel   kube-flannel-ds-sxgxl            <span class="token number">1</span>/1     Running   <span class="token number">1</span> <span class="token punctuation">(</span>7m8s ago<span class="token punctuation">)</span>   21m
kube-flannel   kube-flannel-ds-xvrq6            <span class="token number">1</span>/1     Running   <span class="token number">0</span>              21m
kube-system    coredns-5bbd96d687-gvjf8         <span class="token number">1</span>/1     Running   <span class="token number">0</span>              41m
kube-system    coredns-5bbd96d687-nvc4v         <span class="token number">1</span>/1     Running   <span class="token number">0</span>              41m
kube-system    etcd-master                      <span class="token number">1</span>/1     Running   <span class="token number">0</span>              41m
kube-system    kube-apiserver-master            <span class="token number">1</span>/1     Running   <span class="token number">0</span>              41m
kube-system    kube-controller-manager-master   <span class="token number">1</span>/1     Running   <span class="token number">0</span>              41m
kube-system    kube-proxy-7ggkw                 <span class="token number">1</span>/1     Running   <span class="token number">0</span>              31m
kube-system    kube-proxy-ck2p9                 <span class="token number">1</span>/1     Running   <span class="token number">1</span> <span class="token punctuation">(</span>7m8s ago<span class="token punctuation">)</span>   31m
kube-system    kube-proxy-cnr4b                 <span class="token number">1</span>/1     Running   <span class="token number">0</span>              41m
kube-system    kube-scheduler-master            <span class="token number">1</span>/1     Running   <span class="token number">0</span>              41m<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以看到,经过一段时间的等待,flannel插件已经安装完毕.</p>
<p>查看集群节点状态:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get nodes</span>
NAME     STATUS   ROLES           AGE   VERSION
master   Ready    control-plane   35m   v1.26.0
node1    Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>          25m   v1.26.0
node2    Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>          25m   v1.26.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>状态都为<code>Ready</code>,到此K8s集群搭建完毕.</p>
<h3 id="14-Node节点不能使用Kubectl"><a href="#14-Node节点不能使用Kubectl" class="headerlink" title="14. Node节点不能使用Kubectl"></a>14. Node节点不能使用Kubectl</h3><p>解决方案: 将主节点的<code>/etc/kubernetes/admin.conf</code>拷贝到所有子节点的相同位置,并且配置到环境中</p>
<ol>
<li><p>拷贝配置文件</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">scp</span> /etc/kubernetes/admin.conf root@Node-IP:/etc/kubernetes/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>配置子节点</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">"export KUBECONFIG=/etc/kubernetes/admin.conf"</span> <span class="token operator">&gt;&gt;</span> /etc/profile
<span class="token builtin class-name">source</span> /etc/profile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>在子节使用kubectl</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@node2 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get nodes</span>
NAME     STATUS   ROLES           AGE   VERSION
master   Ready    control-plane   15d   v1.26.0
node1    Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>          15d   v1.26.0
node2    Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>          15d   v1.26.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ol>
<hr>

<h1 id="Pod"><a href="#Pod" class="headerlink" title="Pod"></a><em><u>Pod</u></em></h1><h2 id="1-Pod是什么"><a href="#1-Pod是什么" class="headerlink" title="1.Pod是什么"></a><u><em>1.Pod是什么</em></u></h2><blockquote>
<p><strong>摘取官方:</strong> <strong>Pod</strong>是Kubernetes中创建、管理的最小的计算单元。</p>
</blockquote>
<p>在Docker中,管理的<strong>资源</strong>或者<strong>单位</strong>都是一个一个的<strong>容器(Container)</strong>。<br>而在Kubernetes是使用<code>Pod</code>来管理一个或多个<strong>容器</strong>,这些<strong>容器</strong>共享存储、网络等资源。相当于做了一层包装,然后由Kubernetes管理<code>Pod</code>。<br>Pod中的容器总是一同调度的,它们是一个整体,在共享的上下文中运行。</p>
<h2 id="2-为什么要有Pod"><a href="#2-为什么要有Pod" class="headerlink" title="2.为什么要有Pod"></a><em><u>2.为什么要有Pod</u></em></h2><p>一个应用程序的运行通常会依赖很多第三方程序,比如一个Web服务,它可能需要依赖于Mysql、Redis、Es等常见中间件。<br>K8s的想法就是将主程序和依赖程序封装为一个个的Container,然后打包为一个<code>Pod</code>,它们之间是资源共享的。<br>你可以认为: <strong>一个完整的应用程序在K8s中就是一个<code>Pod</code>单元。</strong></p>
<h2 id="3-Pod的使用"><a href="#3-Pod的使用" class="headerlink" title="3.Pod的使用"></a><em><u>3.Pod的使用</u></em></h2><p>通常你不需要直接创建 Pod，甚至单实例 Pod。 相反，你会使用诸如 <code>Deployment</code> 或 <code>Job</code> 这类工作负载资源来创建 Pod。 如果 Pod 需要跟踪状态，可以考虑 <code>StatefulSet</code> 资源。</p>
<p>Kubernetes 集群中的 Pod 主要有两种用法：</p>
<ul>
<li><strong>运行单个容器的 Pod</strong>。”每个 Pod 一个容器” 模型是最常见的 Kubernetes 用例； 在这种情况下，可以将 Pod 看作单个容器的包装器，并且 Kubernetes 直接管理 Pod，而不是容器。</li>
<li><strong>运行多个协同工作的容器 的 Pod</strong>。 Pod 可能封装由多个紧密耦合且需要共享资源的共处容器组成的应用程序。 这些位于同一位置的容器可能形成单个内聚的服务单元 —— 一个容器将文件从共享卷提供给公众， 而另一个单独的 “边车”（sidecar）容器则刷新或更新这些文件。 Pod 将这些容器和存储资源打包为一个可管理的实体。</li>
</ul>
<p><strong>说明: </strong></p>
<ul>
<li>将多个并置、同管的容器组织到一个 Pod 中是一种相对高级的使用场景。 只有在一些场景中，容器之间紧密关联时你才应该使用这种模式。</li>
<li>每个 Pod 都旨在运行给定应用程序的单个实例。如果希望横向扩展应用程序 （例如，运行多个实例以提供更多的资源），则应该使用多个 Pod，每个实例使用一个 Pod。 在 Kubernetes 中，这通常被称为<strong>副本（Replication）</strong>。 通常使用一种工作负载资源及其控制器来创建和管理一组 Pod 副本。</li>
</ul>
<h2 id="4-创建Pod"><a href="#4-创建Pod" class="headerlink" title="4.创建Pod"></a>4.<em><u>创建Pod</u></em></h2><p><code>Pod</code>的创建分为两种方式,第一种就是通过<code>kubectl run</code>命令式创建一个<code>Pod</code>,类似于Docker中的<code>docker run</code>命令。第二种则是通过编写配置文件的方式。</p>
<h3 id="4-1-通过命令创建Pod"><a href="#4-1-通过命令创建Pod" class="headerlink" title="4.1 通过命令创建Pod"></a>4.1 通过命令创建Pod</h3><p>语法如下:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">kubectl run <span class="token punctuation">[</span>pod名称<span class="token punctuation">]</span> --image<span class="token operator">=</span><span class="token punctuation">[</span>镜像名:版本<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>示例:</strong> 创建一个包含nginx容器的<code>Pod</code>。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 创建Pod</span>
$ kubectl run ng-pod --image<span class="token operator">=</span>nginx:1.14.2
pod/ng-pod created

<span class="token comment"># 查看Pod</span>
$ kubectl get pods
NAME     READY   STATUS              RESTARTS   AGE
ng-pod   <span class="token number">0</span>/1     ContainerCreating   <span class="token number">0</span>          36s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>如果没有本地没有镜像,将会自动拉取镜像,所以需要一定的等待时间。</p>
<p>如果想要查看<code>Pod</code>的详细信息,可通过<code>kubectl describe pod [Pod名称]</code>命令来查看:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 查看ng-pod的详细信息</span>
$ kubectl describe pod ng-pod

Name:             ng-pod		<span class="token comment"># pod名称</span>
Namespace:        default	 	<span class="token comment"># 命名空间</span>
Priority:         <span class="token number">0</span>					<span class="token comment"># 优先级</span>
Service Account:  default
Node:             minikube/192.168.49.2 <span class="token comment"># 节点信息</span>
Start Time:       Fri, 02 Jun <span class="token number">2023</span> <span class="token number">23</span>:01:59 -0400 <span class="token comment"># 启动时间</span>
Labels:           <span class="token assign-left variable">run</span><span class="token operator">=</span>ng-pod	<span class="token comment"># 标签</span>
Annotations:      <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>		  <span class="token comment"># 注释</span>
Status:           Running			<span class="token comment"># 状态</span>
IP:               <span class="token number">10.244</span>.0.6	<span class="token comment"># 内部IP</span>
IPs:
  IP:  <span class="token number">10.244</span>.0.6
<span class="token comment"># Pod内的容器详细信息</span>
Containers:
  ng-pod: 
    Container ID:   docker://96e5147603e4688faf15e5750659a637bcba74a2637500911cac118eff87a07f <span class="token comment"># 容器ID</span>
    Image:          nginx:1.14.2	<span class="token comment"># 容器使用的镜像:版本</span>
    Image ID:       docker-pullable://nginx@sha256:f7988fb6c02e0ce69257d9bd9cf37ae20a60f1df7563c3a2a6abe24160306b8d
    Port:           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
    Host Port:      <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
    State:          Running <span class="token comment"># 容器状态</span>
      Started:      Fri, 02 Jun <span class="token number">2023</span> <span class="token number">23</span>:05:10 -0400 
    Ready:          True
    Restart Count:  <span class="token number">0</span>
    Environment:    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-v2z54 <span class="token punctuation">(</span>ro<span class="token punctuation">)</span>
Conditions:
  Type              Status
  Initialized       True 
  Ready             True 
  ContainersReady   True 
  PodScheduled      True 
Volumes:
  kube-api-access-v2z54:
    Type:                    Projected <span class="token punctuation">(</span>a volume that contains injected data from multiple sources<span class="token punctuation">)</span>
    TokenExpirationSeconds:  <span class="token number">3607</span>
    ConfigMapName:           kube-root-ca.crt
    ConfigMapOptional:       <span class="token operator">&lt;</span>nil<span class="token operator">&gt;</span>
    DownwardAPI:             <span class="token boolean">true</span>
QoS Class:                   BestEffort
Node-Selectors:              <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Tolerations:                 node.kubernetes.io/not-ready:NoExecute <span class="token assign-left variable">op</span><span class="token operator">=</span>Exists <span class="token keyword">for</span> 300s
                             node.kubernetes.io/unreachable:NoExecute <span class="token assign-left variable">op</span><span class="token operator">=</span>Exists <span class="token keyword">for</span> 300s
Events:
  Type    Reason     Age    From               Message
  ----    ------     ----   ----               -------
  Normal  Scheduled  5m35s  default-scheduler  Successfully assigned default/ng-pod to minikube
  Normal  Pulling    5m34s  kubelet            Pulling image <span class="token string">"nginx:1.14.2"</span>
  Normal  Pulled     2m24s  kubelet            Successfully pulled image <span class="token string">"nginx:1.14.2"</span> <span class="token keyword">in</span> 3m10.499120068s <span class="token punctuation">(</span>3m10.499123068s including waiting<span class="token punctuation">)</span>
  Normal  Created    2m24s  kubelet            Created container ng-pod
  Normal  Started    2m24s  kubelet            Started container ng-pod<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>当<code>Pod</code>的状态为<code>Running</code>就表示已经运行起来了,不过这种方式我们简单了解一下即可,因为这个方式通常并不常用,第二种才是我们常用的方式。</p>
<h3 id="4-2-通过配置创建Pod"><a href="#4-2-通过配置创建Pod" class="headerlink" title="4.2 通过配置创建Pod"></a>4.2 通过配置创建Pod</h3><p>Kubernetes的配置都使用<code>yaml</code>格式，我们需要将<code>Pod</code>的相关信息以及<code>Containers</code>的信息全部写入到配置文件内。</p>
<p>下面我们通过<strong>声明式配置</strong>的方式来创建一个Nginx容器的<code>Pod</code>。创建配置文件<code>ng-pod.yml</code>。</p>
<p>配置内容如下:</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1 <span class="token comment"># 版本号</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod <span class="token comment"># 配置类型 表示这个配置为Pod配置</span>
<span class="token comment"># Pod元数据信息</span>
<span class="token key atrule">metadata</span><span class="token punctuation">:</span> 
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>pod <span class="token comment"># Pod名称,用于唯一标识Pod对象。</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default <span class="token comment"># Pod所属命名空间,默认为default</span>
	<span class="token comment"># Pod预期行为的配置</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span> 
	<span class="token comment"># 容器列表</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ng <span class="token comment"># 容器名</span>
      <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>1.14.2 <span class="token comment"># 镜像</span>
      <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent <span class="token comment"># 镜像拉取策略: 只有本地不存在该镜像时,则会拉取新的镜像</span>
      <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span> <span class="token comment"># 容器要暴露出的端口</span>
  <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Always <span class="token comment"># Pod重启策略,如果容器停止(无论正常退出还是异常),会自动重启容器。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>接下来就可以通过k8s来执行这个配置,k8s提供了两种命令来执行配置:</p>
<ul>
<li><code>kubectl create -f</code></li>
<li><code>kubectl apply -f</code></li>
</ul>
<blockquote>
<p>它们的区别就是<code>create</code>仅仅在不存在的时候创建,如果已经存在了则会报错!而<code>apply</code>如果已存在则更新配置。推荐使用<code>apply</code></p>
</blockquote>
<p>通过<code>apply</code>运行配置:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ kubectl apply -f ng-pod.yml
pod/ng-pod created<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>查看运行结果:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ kubectl get pods
NAME     READY   STATUS    RESTARTS   AGE
ng-pod   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          95s

$ kubectl describe pod ng-pod
Name:             ng-pod
Namespace:        default
Priority:         <span class="token number">0</span>
Service Account:  default
Node:             minikube/192.168.49.2
Start Time:       Sun, 04 Jun <span class="token number">2023</span> 01:58:52 -0400
Labels:           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Annotations:      <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Status:           Running
IP:               <span class="token number">10.244</span>.0.8
<span class="token punctuation">..</span><span class="token punctuation">..</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="5-查询Pod"><a href="#5-查询Pod" class="headerlink" title="5.查询Pod"></a>5.<u><em>查询Pod</em></u></h2><p><code>Pod</code>通常归属于不同的<code>namespace</code>(命名空间),如果不指定<code>namespace</code>则默认查询<code>default</code>默认命名空间。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ kubectl get pod

NAME     READY   STATUS    RESTARTS   AGE
ng-pod   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          5h13m<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里的<code>pod</code>也可以写成<code>pods</code>或者<code>po</code>。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ kubectl get pods
$ kubectl get pod
$ kubectl get po<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>这三种写法都支持。</p>
<p>如果想查询指定命名空间的<code>pod</code>,可以通过<code>-n [命名空间]</code>参数指定查询:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ kubectl get pod -n default

NAME     READY   STATUS    RESTARTS   AGE
ng-pod   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          5h17m<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>如果想查询所有命名空间的<code>pod</code>,直接通过<code>-A</code>参数即可:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ kubectl get pod -A
NAMESPACE     NAME                               READY   STATUS    RESTARTS        AGE
default       ng-pod                             <span class="token number">1</span>/1     Running   <span class="token number">0</span>               5h19m
kube-system   coredns-787d4945fb-xs8g6           <span class="token number">1</span>/1     Running   <span class="token number">4</span> <span class="token punctuation">(</span>20h ago<span class="token punctuation">)</span>     6d8h
kube-system   etcd-minikube                      <span class="token number">1</span>/1     Running   <span class="token number">4</span> <span class="token punctuation">(</span>20h ago<span class="token punctuation">)</span>     6d8h
kube-system   kube-apiserver-minikube            <span class="token number">1</span>/1     Running   <span class="token number">4</span> <span class="token punctuation">(</span>20h ago<span class="token punctuation">)</span>     6d8h
kube-system   kube-controller-manager-minikube   <span class="token number">1</span>/1     Running   <span class="token number">4</span> <span class="token punctuation">(</span>20h ago<span class="token punctuation">)</span>     6d8h
kube-system   kube-proxy-pqjjv                   <span class="token number">1</span>/1     Running   <span class="token number">4</span> <span class="token punctuation">(</span>20h ago<span class="token punctuation">)</span>     6d8h
kube-system   kube-scheduler-minikube            <span class="token number">1</span>/1     Running   <span class="token number">4</span> <span class="token punctuation">(</span>20h ago<span class="token punctuation">)</span>     6d8h
kube-system   storage-provisioner                <span class="token number">1</span>/1     Running   <span class="token number">8</span> <span class="token punctuation">(</span>5h26m ago<span class="token punctuation">)</span>   6d8h<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>并且还可以通过<code>-o wide</code>参数进一步查看<code>pod</code>的更多信息:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ kubectl get pod -o wide

NAME     READY   STATUS    RESTARTS   AGE     IP           NODE       NOMINATED NODE   READINESS GATES
ng-pod   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          5h20m   <span class="token number">10.244</span>.0.8   minikube   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>如果想查看一个<code>pod</code>的详细信息,可以通过如下命令查询:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ kubectl describe pod ng-pod
Name:             ng-pod
Namespace:        default
Priority:         <span class="token number">0</span>
Service Account:  default
Node:             minikube/192.168.49.2
Start Time:       Sun, 04 Jun <span class="token number">2023</span> 01:58:52 -0400
Labels:           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Annotations:      <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Status:           Running
IP:               <span class="token number">10.244</span>.0.8
IPs:
  IP:  <span class="token number">10.244</span>.0.8
  <span class="token punctuation">..</span><span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>命令总结:</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 查看默认命名空间的Pod</span>
$ kubectl get <span class="token punctuation">[</span>pods <span class="token operator">|</span> pod <span class="token operator">|</span> po<span class="token punctuation">]</span>
<span class="token comment"># pods可以简写为pod或po</span>

<span class="token comment"># 查看所有命名空间的Pod</span>
$ kubectl get <span class="token punctuation">[</span>pods <span class="token operator">|</span> pod <span class="token operator">|</span> po<span class="token punctuation">]</span> -A

<span class="token comment"># 查看指定命名空间的Pod</span>
$ kubectl get pods -n <span class="token punctuation">[</span>命名空间名称<span class="token punctuation">]</span>

<span class="token comment"># 查看Pod的详细信息</span>
$ kubectl get pods -A -o wide

<span class="token comment"># 实时监控pod的状态</span>
$ kubectl get pod -w

<span class="token comment"># 查看一个Pod的详细信息</span>
$ kubectl describe pod <span class="token punctuation">[</span>Pod名称<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="6-删除Pod"><a href="#6-删除Pod" class="headerlink" title="6.删除Pod"></a>6.<u><em>删除Pod</em></u></h2><p>如果想删除一个<code>pod</code>也可以通过<code>pod</code>的名称删除:</p>
<p><code>kubectl delete pod [Pod名称]</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ kubectl delete pod ng-pod
pod <span class="token string">"ng-pod"</span> deleted<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>也可以通过创建<code>pod</code>的配置文件删除:</p>
<p><code>kubectl delete -f xxx.yml</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ kubectl delete -f ng-pod.yml 
pod <span class="token string">"ng-pod"</span> deleted<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="7-进入Pod容器"><a href="#7-进入Pod容器" class="headerlink" title="7.进入Pod容器"></a>7.<em><u>进入Pod容器</u></em></h2><p>在k8s中,我们可以像Docker一样,进入<code>container</code>的内部进行操作。通过如下命令:</p>
<p><code>kubectl exec -it [pod名称] -- bash</code>。该命令表示进入<code>pod</code>的第一个<code>container</code>内部。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 进入 ng-pod内部</span>
$ kubectl <span class="token builtin class-name">exec</span> -it ng-pod -- <span class="token function">bash</span>

root@ng-pod:/<span class="token comment"># ls</span>
bin  boot  dev  etc  home  lib  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这个<code>Pod</code>内启动了一个Nginx容器,我们可以查看一下Nginx的<code>index.html</code>内容:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@ng-pod:/<span class="token comment"># cat /usr/share/nginx/html/index.html </span>

<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
    body <span class="token punctuation">{</span>
        width: 35em<span class="token punctuation">;</span>
        margin: <span class="token number">0</span> auto<span class="token punctuation">;</span>
        font-family: Tahoma, Verdana, Arial, sans-serif<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span>/style<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.<span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>For online documentation and support please refer to
<span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"http://nginx.org/"</span><span class="token operator">&gt;</span>nginx.org<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span>.<span class="token operator">&lt;</span>br/<span class="token operator">&gt;</span>
Commercial support is available at
<span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"http://nginx.com/"</span><span class="token operator">&gt;</span>nginx.com<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span>.<span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token operator">&lt;</span>em<span class="token operator">&gt;</span>Thank you <span class="token keyword">for</span> using nginx.<span class="token operator">&lt;</span>/em<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>如果一个<code>Pod</code>中有多个<code>container</code>,我们可以通过如下命令指定要进入的<code>container</code>:</p>
<p><code>kubectl exec -it [pod名称] -c [container名称] -- bash</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ kubectl <span class="token builtin class-name">exec</span> -it ng-pod -c ng -- <span class="token function">bash</span>

root@ng-pod:/<span class="token comment"># ls </span>
bin  boot  dev  etc  home  lib  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="8-查看Pod日志"><a href="#8-查看Pod日志" class="headerlink" title="8.查看Pod日志"></a>8.<em><u>查看Pod日志</u></em></h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 查看 pod日志</span>
$ kubectl logs <span class="token punctuation">[</span>pod名称<span class="token punctuation">]</span>

<span class="token comment"># 实时查看pod日志</span>
$ kubectl logs -f  <span class="token punctuation">[</span>pod名称<span class="token punctuation">]</span>

<span class="token comment"># 查看指定容器日志</span>
$ kubectl logs -f <span class="token punctuation">[</span>pod名称<span class="token punctuation">]</span> -c <span class="token punctuation">[</span>容器名称<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="10-Pod运行多个容器"><a href="#10-Pod运行多个容器" class="headerlink" title="10.Pod运行多个容器"></a>10.<em><u>Pod运行多个容器</u></em></h2><p>一个<code>Pod</code>中可以运行多个容器。下面我们创建一个Nginx和Redis的<code>Pod</code>,并且对外暴露使用。</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># 文件版本号</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token comment"># 配置类型为Pod</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token comment"># 元数据</span>
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token comment"># pod名称</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>redis<span class="token punctuation">-</span>service
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
  <span class="token comment"># Pod的标签,或者叫别名</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>redis
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
	<span class="token comment"># Pod的网络通信方式</span>
  <span class="token key atrule">hostNetwork</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment"># 容器重启策略</span>
  <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Always
  <span class="token comment"># 容器列表</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token comment"># Nginx容器配置</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
      <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>1.14.2
      <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token comment"># redis容器配置</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> redis
      <span class="token key atrule">image</span><span class="token punctuation">:</span> redis<span class="token punctuation">:</span>5.0.10
      <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">6379</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p> <code>hostNetwork: true</code>这里表示可以直接通过<code>Pod</code>所在的主机IP访问到内部的容器。</p>
<p>接下来运行该配置:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ kubectl apply -f ng_redis-pod.yml
ng-redis-service created<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>然后查看Pod信息:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ kubectl get pods -o wide
NAME               READY   STATUS    RESTARTS   AGE    IP              NODE    NOMINATED NODE   READINESS GATES
ng-redis-service   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          110s   <span class="token number">192.168</span>.0.112   node2   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>可以看到,<code>ng-redis-service</code>Pod已经运行完成,并且调度在<code>node2</code>节点中,<code>IP</code>为<code>192.168.0.112</code>，由于该Pod开启了<code>hostNetwork</code>,所以可以直接通过IP+端口访问。</p>
<p>测试是否可以访问Nginx容器:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">curl</span> <span class="token number">192.168</span>.0.112
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
    body <span class="token punctuation">{</span>
        width: 35em<span class="token punctuation">;</span>
        margin: <span class="token number">0</span> auto<span class="token punctuation">;</span>
        font-family: Tahoma, Verdana, Arial, sans-serif<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span>/style<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.<span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>For online documentation and support please refer to
<span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"http://nginx.org/"</span><span class="token operator">&gt;</span>nginx.org<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span>.<span class="token operator">&lt;</span>br/<span class="token operator">&gt;</span>
Commercial support is available at
<span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"http://nginx.com/"</span><span class="token operator">&gt;</span>nginx.com<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span>.<span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token operator">&lt;</span>em<span class="token operator">&gt;</span>Thank you <span class="token keyword">for</span> using nginx.<span class="token operator">&lt;</span>/em<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>测试是否能够访问Redis容器:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ redis-cli -h <span class="token number">192.168</span>.0.112

<span class="token number">192.168</span>.0.112:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> keys *
<span class="token punctuation">(</span>empty array<span class="token punctuation">)</span>
<span class="token number">192.168</span>.0.112:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>也是可以的~</p>
<p>如果想查看该<code>Pod</code>的日志可以通过如下命令:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ kubectl logs -f ng-redis-service
Defaulted container <span class="token string">"nginx"</span> out of: nginx, redis
<span class="token number">192.168</span>.0.110 - - <span class="token punctuation">[</span>06/Jun/2023:11:57:33 +0000<span class="token punctuation">]</span> <span class="token string">"GET / HTTP/1.1"</span> <span class="token number">200</span> <span class="token number">612</span> <span class="token string">"-"</span> <span class="token string">"curl/7.29.0"</span> <span class="token string">"-"</span>
<span class="token number">192.168</span>.0.102 - - <span class="token punctuation">[</span>06/Jun/2023:11:57:41 +0000<span class="token punctuation">]</span> <span class="token string">"GET / HTTP/1.1"</span> <span class="token number">304</span> <span class="token number">0</span> <span class="token string">"-"</span> <span class="token string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36"</span> <span class="token string">"-"</span>
<span class="token number">192.168</span>.0.102 - - <span class="token punctuation">[</span>06/Jun/2023:11:57:43 +0000<span class="token punctuation">]</span> <span class="token string">"GET / HTTP/1.1"</span> <span class="token number">304</span> <span class="token number">0</span> <span class="token string">"-"</span> <span class="token string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36"</span> <span class="token string">"-"</span>
<span class="token number">192.168</span>.0.110 - - <span class="token punctuation">[</span>06/Jun/2023:12:03:53 +0000<span class="token punctuation">]</span> <span class="token string">"GET / HTTP/1.1"</span> <span class="token number">200</span> <span class="token number">612</span> <span class="token string">"-"</span> <span class="token string">"curl/7.29.0"</span> <span class="token string">"-"</span>
<span class="token number">192.168</span>.0.102 - - <span class="token punctuation">[</span>06/Jun/2023:12:04:47 +0000<span class="token punctuation">]</span> <span class="token string">"GET / HTTP/1.1"</span> <span class="token number">304</span> <span class="token number">0</span> <span class="token string">"-"</span> <span class="token string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36"</span> <span class="token string">"-"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>默认会查看第一个容器的日志,可以通过<code>-c redis</code>来查看Redis容器的日志:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ kubectl logs -f ng-redis-service -c redis
<span class="token number">1</span>:C 06 Jun <span class="token number">2023</span> <span class="token number">11</span>:55:48.700 <span class="token comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span>
<span class="token number">1</span>:C 06 Jun <span class="token number">2023</span> <span class="token number">11</span>:55:48.700 <span class="token comment"># Redis version=5.0.10, bits=64, commit=00000000, modified=0, pid=1, just started</span>
<span class="token number">1</span>:C 06 Jun <span class="token number">2023</span> <span class="token number">11</span>:55:48.700 <span class="token comment"># Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf</span>
<span class="token number">1</span>:M 06 Jun <span class="token number">2023</span> <span class="token number">11</span>:55:48.724 * Running <span class="token assign-left variable">mode</span><span class="token operator">=</span>standalone, <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">6379</span>.
<span class="token number">1</span>:M 06 Jun <span class="token number">2023</span> <span class="token number">11</span>:55:48.725 <span class="token comment"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span>
<span class="token number">1</span>:M 06 Jun <span class="token number">2023</span> <span class="token number">11</span>:55:48.725 <span class="token comment"># Server initialized</span>
<span class="token number">1</span>:M 06 Jun <span class="token number">2023</span> <span class="token number">11</span>:55:48.725 <span class="token comment"># WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command 'echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled' as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.</span>
<span class="token number">1</span>:M 06 Jun <span class="token number">2023</span> <span class="token number">11</span>:55:48.725 * Ready to accept connections<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="11-Label"><a href="#11-Label" class="headerlink" title="11.Label"></a>11.<em><u>Label</u></em></h2><p><code>标签(Labels)</code>是附加到Kubernetes对象(Pod)上的键值对格式的标签。标签可以在创建时附加到对象中,也可以随后动态添加。每个标签的键(key)在对象中必须是唯一的。</p>
<p>标签的主要作用: 通过使用Pod的Label，可以更好地组织和管理Kubernetes集群中的Pod。Label可以帮助你标识、选择和操作特定的Pod，并支持在Kubernetes中实现更高级的部署和管理策略。</p>
<p>如下:</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>service
  <span class="token comment"># 为该Pod打一个key为`app` value为`nginx`的标签</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
      <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>1.14.2
      <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>运行该配置:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ kubectl apply -f lable-pod.yml 
pod/ng-service created<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>通过<code>--show-labels</code>查看Pod的标签:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ kubectl get pods --show-labels

NAME         READY   STATUS    RESTARTS   AGE   LABELS
ng-service   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          57s   <span class="token assign-left variable">app</span><span class="token operator">=</span>nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="1-添加label"><a href="#1-添加label" class="headerlink" title="1.添加label"></a>1.添加label</h4><p>k8s支持动态为资源对象添加<code>label</code>。比如为一个<code>Pod</code>添加:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ kubectl label pod ng-service <span class="token assign-left variable">env</span><span class="token operator">=</span>dev
pod/ng-service labeled<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>再次查看Pod信息:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ kubectl get pods --show-labels

NAME         READY   STATUS    RESTARTS   AGE    LABELS
ng-service   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          6m1s   <span class="token assign-left variable">app</span><span class="token operator">=</span>nginx,env<span class="token operator">=</span>dev<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="2-修改label"><a href="#2-修改label" class="headerlink" title="2.修改label"></a>2.修改label</h4><p>如果一个<code>label</code>不小心打错了,可以通过<code>--overwrite</code>来修改:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ kubectl label --overwrite pod ng-service <span class="token assign-left variable">env</span><span class="token operator">=</span>prod
pod/ng-service labeled

$ kubectl get pods --show-labels
NAME         READY   STATUS    RESTARTS   AGE     LABELS
ng-service   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          9m31s   <span class="token assign-left variable">app</span><span class="token operator">=</span>nginx,env<span class="token operator">=</span>prod<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="3-删除label"><a href="#3-删除label" class="headerlink" title="3.删除label"></a>3.删除label</h4><p>如果我们想删除一个<code>label</code>可以通过这样的语法来删除:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ kubectl label pod ng-service env-
pod/ng-service unlabeled<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><code>env-</code>表示删除<code>env</code>这个标签。</p>
<h4 id="4-筛选label"><a href="#4-筛选label" class="headerlink" title="4.筛选label"></a>4.筛选label</h4><p><code>label</code>的主要作用,通常是用来查询pod时,作为条件筛选,这样就能在成千上万的pod中找到我们所需要的pod。</p>
<p>查询语法如下:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 查询标签key有app的Pod</span>
$ kubectl get pods -l app 

<span class="token comment"># 查询标签key有app 并且value为nginx的Pod</span>
$ kubectl get pods -l <span class="token assign-left variable">app</span><span class="token operator">=</span>nginx

<span class="token comment"># 查询标签中不包含app的Pod</span>
$ kubectl get pods -l <span class="token string">'!app'</span>

<span class="token comment"># 查询标签含有指定值的Pod</span>
$ kubectl get pods -l <span class="token string">'app in (redis,nginx)'</span>

<span class="token comment"># 查询标签含没有指定值的Pod</span>
$ kubectl get pods -l <span class="token string">'app notin (redis,nginx)'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="12-Pod生命周期"><a href="#12-Pod生命周期" class="headerlink" title="12.Pod生命周期"></a>12.<em><u>Pod生命周期</u></em></h3><blockquote>
<p>摘自官网: <a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/pod-lifecycle/">https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/pod-lifecycle/</a></p>
</blockquote>
<p>Pod 遵循预定义的生命周期，起始于 <code>Pending</code> <a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/pod-lifecycle/#pod-phase">阶段</a>， 如果至少其中有一个主要容器正常启动，则进入 <code>Running</code>，之后取决于 Pod 中是否有容器以失败状态结束而进入 <code>Succeeded</code> 或者 <code>Failed</code> 阶段。</p>
<p>一个Pod的生命周期分为如下几个阶段:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>取值</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Pending</code>(悬决)</td>
<td>Pod资源获取阶段。Pod已经被K8s集群所接受,但有一个或者多个容器尚未创建亦未运行。此阶段包括等待 Pod 被调度的时间和通过网络下载镜像的时间。</td>
</tr>
<tr>
<td><code>Running</code>(运行)</td>
<td>运行状态。Pod已经被调度到某个节点,所有的容器都已经被创建完成,并且至少有一个容器已经被运行成功。</td>
</tr>
<tr>
<td><code>Success</code>(成功)</td>
<td>Pod中所有的容器都已经运行成功,并且不会再重启。</td>
</tr>
<tr>
<td><code>Failed</code>(失败)</td>
<td>Pod 中的所有容器都已终止，并且至少有一个容器是因为失败终止。也就是说，容器以非 0 状态退出或者被系统终止。</td>
</tr>
<tr>
<td><code>Unknown</code>(未知)</td>
<td>因为某些原因无法取得 Pod 的状态。这种情况通常是因为与 Pod 所在主机通信失败。</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p><strong>说明：</strong></p>
<p>当一个 Pod 被删除时，执行一些 kubectl 命令会展示这个 Pod 的状态为 <code>Terminating</code>（终止）。 这个 <code>Terminating</code> 状态并不是 Pod 阶段之一。 Pod 被赋予一个可以体面终止的期限，默认为 30 秒。 你可以使用 <code>--force</code> 参数来<a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/pod-lifecycle/#pod-termination-forced">强制终止 Pod</a>。</p>
</blockquote>
<hr>

<h1 id="Container"><a href="#Container" class="headerlink" title="Container"></a><em><u>Container</u></em></h1><blockquote>
<p><code>Container</code>是<code>Pod</code>中的资源单位,通常一个<code>Pod</code>中包含多个<code>Container</code>。</p>
</blockquote>
<h2 id="1-容器生命周期"><a href="#1-容器生命周期" class="headerlink" title="1. 容器生命周期"></a>1. <em><u>容器生命周期</u></em></h2><p>Kubernetes 会跟踪 Pod 中每个容器的状态，就像它跟踪 Pod 总体上的<a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/pod-lifecycle/#pod-phase">阶段</a>一样。 你可以使用<a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/concepts/containers/container-lifecycle-hooks/">容器生命周期回调</a> 来在容器生命周期中的特定时间点触发事件。</p>
<p>一旦<a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/reference/command-line-tools-reference/kube-scheduler/">调度器</a>将 Pod 分派给某个节点，<code>kubelet</code> 就通过<a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes">容器运行时</a>开始为 Pod 创建容器。容器的状态有三种：<code>Waiting</code>（等待）、<code>Running</code>（运行中）和 <code>Terminated</code>（已终止）。</p>
<p>每种状态都有特定的含义:</p>
<ul>
<li><p><strong>Waiting(等待)</strong></p>
<p>处于 <code>Waiting</code> 状态的容器仍在运行它完成启动所需要的操作：例如， 从某个容器镜像仓库拉取容器镜像，或者向容器应用 <a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/">Secret</a> 数据等等。 当你使用 <code>kubectl</code> 来查询包含 <code>Waiting</code> 状态的容器的 Pod 时，你也会看到一个 Reason 字段，其中给出了容器处于等待状态的原因。</p>
</li>
<li><p><strong>Running(运行中)</strong></p>
<p><code>Running</code> 状态表明容器正在执行状态并且没有问题发生。 如果配置了 <code>postStart</code> 回调，那么该回调已经执行且已完成。 如果你使用 <code>kubectl</code> 来查询包含 <code>Running</code> 状态的容器的 Pod 时， 你也会看到关于容器进入 <code>Running</code> 状态的信息。</p>
</li>
<li><p><strong>Terminated(终止)</strong></p>
<p>处于 <code>Terminated</code> 状态的容器已经开始执行并且或者正常结束或者因为某些原因失败。 如果你使用 <code>kubectl</code> 来查询包含 <code>Terminated</code> 状态的容器的 Pod 时， 你会看到容器进入此状态的原因、退出代码以及容器执行期间的起止时间。</p>
<p>如果容器配置了 <code>preStop</code> 回调，则该回调会在容器进入 <code>Terminated</code> 状态之前执行。</p>
</li>
</ul>
<hr>

<h2 id="2-生命周期回调"><a href="#2-生命周期回调" class="headerlink" title="2. 生命周期回调"></a>2. <em><u>生命周期回调</u></em></h2><blockquote>
<p>容器的<code>生命周期回调</code>指的是在容器启动过程中的某个关键点,执行一些特定的操作。例如: 在一个容器进入<code>Running</code>之前,通过<code>postStart</code>事件来检测其他容器是否启动完成。类类似于<code>Vue</code>框架提供的钩子回调函数。</p>
</blockquote>
<p>有两个回调事件暴露给容器:</p>
<ul>
<li><p><strong>PostStart</strong></p>
<p>该事件在容器的启动过程中，在容器的<code>entrypoint</code>之前执行。</p>
</li>
<li><p><strong>PreStop</strong></p>
<p><code>PreStop</code>事件在容器<code>Terminated</code>(终止)之前执行,即在容器被发送终止信号（SIGTERM）之前执行。它提供了一个机会让容器在终止之前执行一些清理工作。</p>
</li>
</ul>
<p><strong>示例:</strong> </p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>lifecycle
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ng
      <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>1.14.2
      <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
      <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">lifecycle</span><span class="token punctuation">:</span>
        <span class="token comment"># 容器创建过程中回调事件</span>
        <span class="token key atrule">postStart</span><span class="token punctuation">:</span>
          <span class="token key atrule">exec</span><span class="token punctuation">:</span>
            <span class="token comment"># 执行的操作命令</span>
            <span class="token comment"># 写入一个文本到文件中</span>
            <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"/bin/sh"</span><span class="token punctuation">,</span><span class="token string">"-c"</span><span class="token punctuation">,</span><span class="token string">"echo postStart event... &gt;&gt; /event.txt"</span><span class="token punctuation">]</span>
        <span class="token comment"># 容器终止之前要执行的回调事件</span>
        <span class="token key atrule">preStop</span><span class="token punctuation">:</span>
          <span class="token key atrule">exec</span><span class="token punctuation">:</span>
            <span class="token comment"># 写入一个文本到文件内,并且睡眠10秒后再终止容器</span>
            <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"/bin/sh"</span><span class="token punctuation">,</span><span class="token string">"-c"</span><span class="token punctuation">,</span><span class="token string">"echo preStop event... &gt;&gt; /event.txt &amp;&amp; sleep 10"</span><span class="token punctuation">]</span>
  <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Always<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>该示例在容器启动时,将<code>postStart event...</code>写入到<code>/event.txt</code>文件中,并且在终止之前将<code>preStop event...</code>也写入到该文件中,并且睡眠10秒后再停止容器。</p>
<p>执行该配置:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 执行该文件</span>
$ kubectl apply -f ng-lifecycle.yml 
pod/ng-lifecycle created

<span class="token comment"># 进入该容器,查看是否有event.txt文件</span>
$ kubectl <span class="token builtin class-name">exec</span> -it ng-lifecycle -c ng -- /bash
root@ng-lifecycle:/<span class="token comment"># ls</span>
bin  boot  dev  etc  event.txt  home  lib  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
root@ng-lifecycle:/<span class="token comment"># cat event.txt </span>
postStart event<span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>接下来我们来删除该Pod:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ kubectl delete -f ng-lifecycle.yml
<span class="token punctuation">..</span>.  <span class="token comment"># 这里会阻塞10秒才会返回结果,等待preStop事件执行结束</span>
pod <span class="token string">"ng-lifecycle"</span> deleted<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>并且<code>event.txt</code>文件也会产生变化:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@ng-lifecycle:/<span class="token comment"># tail -f event.txt </span>
postStart event<span class="token punctuation">..</span>.
preStop event<span class="token punctuation">..</span>.
<span class="token builtin class-name">command</span> terminated with <span class="token builtin class-name">exit</span> code <span class="token number">137</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<hr>

<h2 id="3-容器重启策略"><a href="#3-容器重启策略" class="headerlink" title="3. 容器重启策略"></a>3. <em><u>容器重启策略</u></em></h2><blockquote>
<p>Pod 的 <code>spec</code> 中包含一个 <code>restartPolicy</code> 字段，表示为该Pod中的所有容器的重启策略。</p>
</blockquote>
<p><code>restartPolicy</code>取值有如下几种:</p>
<ul>
<li><p><strong>Always</strong>(默认)</p>
<p>总是重启,只要容器退出了,那么就自动重新启动容器。</p>
</li>
<li><p><strong>OnFailure</strong></p>
<p>当容器退出状态非<code>0</code>的时候,也就是非正常退出时才会自动重新启动容器。</p>
</li>
<li><p><strong>Never</strong></p>
<p>容器退出后不会重启。</p>
</li>
</ul>
<h2 id="4-容器启动命令"><a href="#4-容器启动命令" class="headerlink" title="4. 容器启动命令"></a>4. <em><u>容器启动命令</u></em></h2><blockquote>
<p>和 Docker 容器一样,k8s中容器也可以通过command、args 用来修改容器启动默认执行命令以及传递相关参数。<strong>但一般推荐使用 command 修改启动命令，使用 args 为启动命令传递参数。</strong></p>
</blockquote>
<p><strong>示例:</strong>  创建一个Redis容器,自定义Redis的启动命令,并且使用参数开启AOF持久化.</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> redis
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> redis
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> redis
      <span class="token key atrule">image</span><span class="token punctuation">:</span> redis<span class="token punctuation">:</span>5.0.10
      <span class="token comment"># 指定Redis的启动命令</span>
      <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"redis-server"</span><span class="token punctuation">]</span>
      <span class="token comment"># 用来为启动命令传递参数</span>
      <span class="token comment"># 开启AOF持久化参数</span>
      <span class="token key atrule">args</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"--appendonly yes"</span><span class="token punctuation">]</span> 
      <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
  <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Always<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>

<h2 id="5-容器探针"><a href="#5-容器探针" class="headerlink" title="5. 容器探针"></a>5. <em><u>容器探针</u></em></h2><blockquote>
<p>在Kuberentes中,<strong>容器探针(Container Probes)</strong>用于检测和管理Pod内部的容器运行状态,它们是一种用于诊断容器是否<strong>健康、就绪、重启</strong>的机制。</p>
</blockquote>
<h3 id="1-探针类型"><a href="#1-探针类型" class="headerlink" title="1.探针类型"></a>1.探针类型</h3><p>容器探针主要分为三种类型:</p>
<ul>
<li><p><strong>存活探针(Liveness Probe)</strong></p>
<p><strong>用于确定容器是否在正常运行</strong>,如果探测失败,则会杀死当前容器,并且根据其<code>重启策略</code>决定是否重新创建容器。如果容器不提供存活探针,则默认状态为<code>Success</code>表示探测成功。</p>
</li>
<li><p><strong>就绪探针(Readiness Probe)</strong></p>
<p><strong>用于确定容器是否已经准备(初始化)完成,可以接收网络流量</strong>。就绪探针用于确保容器在开始接收流量之前已经完成了必要的初始化过程。如果就绪探针失败，Kubernetes将从负载均衡器中暂时删除该容器，直到它再次就绪。如果容器不提供就绪探针,则默认状态为<code>Success</code>表示探测成功。</p>
</li>
<li><p><strong>启动探针(Startup Probe)</strong></p>
<p><strong>用于确定容器是否已经完全启动</strong>。如果启用了该类型探针,则所有其他探针都会被临时禁用,直到此探针探测成功为止。如果探测失败将会杀死容器,并且根据重启策略决定是否重启。如果容器不提供启动探针,则默认状态为<code>Success</code>表示探测成功。</p>
</li>
</ul>
<h3 id="2-探针的实现机制"><a href="#2-探针的实现机制" class="headerlink" title="2.探针的实现机制"></a>2.探针的实现机制</h3><p>使用探针来检查容器有四种不同的机制,每个探针都必须定义为四种机制中的一种:</p>
<ul>
<li><p><strong>exec</strong></p>
<p>通过在容器内部执行一个终端命令,如果命令返回码为<code>0</code>表示探测成功。</p>
</li>
<li><p><strong>grpc</strong></p>
<p>通过gRPC执行一个远程过程调用。目标应该实现gRPC健康检查。如果响应的状态是 “SERVING”，则认为诊断成功。 gRPC 探针是一个 Alpha 特性，只有在你启用了 “GRPCContainerProbe” 特性门控时才能使用。</p>
</li>
<li><p><strong>httpGet</strong></p>
<p>对容器的 IP 地址上指定端口和路径执行 HTTP<code>GET</code>请求。如果响应码在(200-400 )区间内,则表示探测成功。</p>
</li>
<li><p><strong>tcpSocket</strong></p>
<p>对容器的 IP 地址上的指定端口执行 TCP 检查。如果端口打开，则诊断被认为是成功的。 如果远程系统（容器）在打开连接后立即将其关闭，这算作是健康的。</p>
</li>
</ul>
<h3 id="3-探测结果"><a href="#3-探测结果" class="headerlink" title="3.探测结果"></a>3.探测结果</h3><p>探针的探测结果分为三种:</p>
<ul>
<li><code>Success</code> 探测成功。</li>
<li><code>Failure</code> 探测失败。</li>
<li><code>Unknown</code> 未知。有可能是由于网络超时等未知原因所造成,所以该结果不会采取任何行动。</li>
</ul>
<h3 id="4-探针参数"><a href="#4-探针参数" class="headerlink" title="4.探针参数"></a>4.探针参数</h3><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">5</span>   <span class="token comment"># 容器开始运行后,延迟5秒执行第一次探针</span>
<span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">4</span>    		 <span class="token comment"># 后续的探针检测间隔时间4s</span>
<span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">1</span>  			 <span class="token comment"># 默认检测超时时间为1s</span>
<span class="token key atrule">failureThreshold</span><span class="token punctuation">:</span> <span class="token number">3</span>  		 <span class="token comment"># 检测失败多少次才算真正的检测失败。默认失败次数为3次。</span>
<span class="token key atrule">successThreshold</span><span class="token punctuation">:</span> <span class="token number">1</span>   	 <span class="token comment"># 检测成功多少次才算真正检测成功。这里表示1次检测成功就代表成功</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="5-探针的使用"><a href="#5-探针的使用" class="headerlink" title="5.探针的使用"></a>5.探针的使用</h3><p><strong>示例一: Exec</strong></p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
      <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>1.14.2
      <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
      <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token comment"># 修改默认的启动命令,让nginx延迟7秒后再启动</span>
      <span class="token key atrule">args</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> /bin/sh
        <span class="token punctuation">-</span> <span class="token punctuation">-</span>c
        <span class="token punctuation">-</span> sleep 7;nginx <span class="token punctuation">-</span>g "daemon off;"
      <span class="token comment"># 存活探针</span>
      <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
        <span class="token comment">#exec执行终端命令机制</span>
        <span class="token key atrule">exec</span><span class="token punctuation">:</span>
          <span class="token comment"># 查看nginx的pid文件</span>
          <span class="token key atrule">command</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> cat
            <span class="token punctuation">-</span> /var/run/nginx.pid
        <span class="token comment"># 延迟5秒初次探测</span>
        <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">5</span>
        <span class="token comment"># 每隔4秒探测一次</span>
        <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">4</span>
        <span class="token comment"># 每次探测超时时间为1秒</span>
        <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">1</span>
        <span class="token comment"># 一共探测失败3次才表示失败</span>
        <span class="token key atrule">failureThreshold</span><span class="token punctuation">:</span> <span class="token number">3</span>
        <span class="token comment"># 一共探测成功1次表示成功</span>
        <span class="token key atrule">successThreshold</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token comment"># 重启策略: 总是重启</span>
  <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Always
  <span class="token key atrule">hostNetwork</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>该示例使用<strong>存活探针(Liveness Probe)</strong> + <strong>exec</strong>机制实现:  每隔四秒探测一次<code>/var/run/nginx.pid</code>文件是否存在。</p>
<p>启动后我们尝试手动删除该文件:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@Zero ~<span class="token punctuation">]</span><span class="token comment"># kubectl exec -it nginx -- bash</span>
root@minikube:/<span class="token comment"># rm -rf /var/run/nginx.pid </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>等待一定的时间之后再查看<code>Pod</code>信息:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@Zero ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods</span>
NAME    READY   STATUS    RESTARTS     AGE
nginx   <span class="token number">1</span>/1     Running   <span class="token number">1</span> <span class="token punctuation">(</span>3s ago<span class="token punctuation">)</span>   4m33s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>发现该<code>Pod</code>已经重启了一次。</p>
<p><strong>示例二: </strong> TcpSocket</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> liveness<span class="token punctuation">-</span>tcpsocket
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">tcpsocket</span><span class="token punctuation">:</span> tcpsocket
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.19</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">args</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> /bin/sh
    <span class="token punctuation">-</span> <span class="token punctuation">-</span>c
    <span class="token punctuation">-</span> sleep 7;nginx <span class="token punctuation">-</span>g "daemon off;"  <span class="token comment">#这一步会和初始化同时开始运行，也就是在初始化5s后和7秒之间，会检测出一次失败，7秒后启动后检测正常，所以pod不会重启</span>
    <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
    <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
     <span class="token comment"># 对容器的80端口进行tcp连接探测 </span>
      <span class="token key atrule">tcpSocket</span><span class="token punctuation">:</span>
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">5</span>   <span class="token comment">#初始化时间5s</span>
      <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">4</span>    <span class="token comment">#检测间隔时间4s</span>
      <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">1</span>   <span class="token comment">#默认检测超时时间为1s</span>
      <span class="token key atrule">failureThreshold</span><span class="token punctuation">:</span> <span class="token number">3</span>   <span class="token comment">#默认失败次数为3次，达到3次后重启pod</span>
      <span class="token key atrule">successThreshold</span><span class="token punctuation">:</span> <span class="token number">1</span>   <span class="token comment">#默认成功次数为1次，1 次代表成功</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>示例三: </strong>HttpGet </p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># probe-liveness-httget.yml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> liveness<span class="token punctuation">-</span>httpget
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">httpget</span><span class="token punctuation">:</span> httpget
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.19</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">args</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> /bin/sh
    <span class="token punctuation">-</span> <span class="token punctuation">-</span>c
    <span class="token punctuation">-</span> sleep 7;nginx <span class="token punctuation">-</span>g "daemon off;" <span class="token comment">#这一步会和初始化同时开始运行，也就是在初始化5s后和7秒之间，会检测出一次失败，7秒后启动后检测正常，所以pod不会重启</span>
    <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
    <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
      <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>     <span class="token comment">#httpget</span>
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>   <span class="token comment">#访问的端口</span>
        <span class="token key atrule">path</span><span class="token punctuation">:</span> /index.html   <span class="token comment">#访问的路径</span>
      <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">5</span>   <span class="token comment">#初始化时间5s</span>
      <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">4</span>    <span class="token comment">#检测间隔时间4s</span>
      <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">1</span>   <span class="token comment">#默认检测超时时间为1s</span>
      <span class="token key atrule">failureThreshold</span><span class="token punctuation">:</span> <span class="token number">3</span>   <span class="token comment">#默认失败次数为3次，达到3次后重启pod</span>
      <span class="token key atrule">successThreshold</span><span class="token punctuation">:</span> <span class="token number">1</span>   <span class="token comment">#默认成功次数为1次，1 次代表成功</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>

<iframe height="300px" width="50%" srcdoc="

        <style>
    #root {
        color: red;
    }
        </style>
                                <h1 id='root'>哈哈哈</h1>
                <h1>哈哈哈</h1>
                <h1>哈哈哈</h1>
                <h1>哈哈哈</h1>
                <h1>哈哈哈</h1>
                "></iframe>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://zlx2019.github.io">Zero</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://zlx2019.github.io/article/474f3ce3.html">https://zlx2019.github.io/article/474f3ce3.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://zlx2019.github.io" target="_blank">Zero(˶˚ ᗨ ˚˶)</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Kubernetes/">Kubernetes</a></div><div class="post_share"><div class="social-share" data-image="/img/logo/k8s-logo6.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/reward/wechat.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/reward/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/reward/alipay.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/reward/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/article/210c580a.html" title="Centos7-ARM-Docker安装"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/logo/Docker-logo.png" onerror="onerror=null;src='/img/loadError.jpeg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Centos7-ARM-Docker安装</div></div></a></div><div class="next-post pull-right"><a href="/article/d988d02a.html" title="Rust错误处理进阶篇"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/logo/Rust-logo.png" onerror="onerror=null;src='/img/loadError.jpeg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Rust错误处理进阶篇</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Zero</div><div class="author-info__description">欲买桂花同载酒<br/>终不似,少年游</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">135</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">57</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">38</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/zlx2019"><i class="fab fa-github"></i><span>前往Github</span></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://res.abeim.cn/api/qq/?qq=1143967454" target="_blank" title="QQ"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-QQ"></use></svg></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/397253487" target="_blank" title="BiliBili"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-bilibili"></use></svg></a><a class="social-icon faa-parent animated-hover" href="https://github.com/zlx2019" target="_blank" title="Github"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-github"></use></svg></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-text">简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#K8s%E5%AD%98%E5%9C%A8%E7%9A%84%E6%84%8F%E4%B9%89"><span class="toc-text">K8s存在的意义?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#K8s%E8%83%BD%E5%81%9A%E4%BB%80%E4%B9%88"><span class="toc-text">K8s能做什么?</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84%E7%BB%84%E4%BB%B6"><span class="toc-text">架构组件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Control-Plane"><span class="toc-text">Control Plane</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Node"><span class="toc-text">Node</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-text">安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-minikubu-%E5%8D%95%E8%8A%82%E7%82%B9"><span class="toc-text">1. minikubu(单节点)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E8%A3%B8%E6%9C%BA%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85"><span class="toc-text">2. 裸机集群安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%90%8C%E6%AD%A5hosts%E6%96%87%E4%BB%B6"><span class="toc-text">1. 同步hosts文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99"><span class="toc-text">2. 关闭防火墙</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%85%B3%E9%97%ADswap%E5%88%86%E5%8C%BA"><span class="toc-text">3. 关闭swap分区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%90%8C%E6%AD%A5%E6%97%B6%E9%97%B4"><span class="toc-text">4. 同步时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%AE%89%E8%A3%85Containerd"><span class="toc-text">5. 安装Containerd</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E9%85%8D%E7%BD%AEContainerd"><span class="toc-text">6. 配置Containerd</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E9%85%8D%E7%BD%AEk8s%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE"><span class="toc-text">7. 配置k8s网络配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-%E9%87%8D%E5%90%AF%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9"><span class="toc-text">9. 重启所有节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-%E5%AE%89%E8%A3%85k8s"><span class="toc-text">10. 安装k8s</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-%E5%88%9D%E5%A7%8B%E5%8C%96%E9%9B%86%E7%BE%A4"><span class="toc-text">11. 初始化集群</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-%E9%85%8D%E7%BD%AE%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6"><span class="toc-text">12. 配置网络插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-%E6%9F%A5%E7%9C%8B%E9%9B%86%E7%BE%A4%E7%8A%B6%E6%80%81"><span class="toc-text">13. 查看集群状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-Node%E8%8A%82%E7%82%B9%E4%B8%8D%E8%83%BD%E4%BD%BF%E7%94%A8Kubectl"><span class="toc-text">14. Node节点不能使用Kubectl</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Pod"><span class="toc-text">Pod</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Pod%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">1.Pod是什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E6%9C%89Pod"><span class="toc-text">2.为什么要有Pod</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Pod%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">3.Pod的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%88%9B%E5%BB%BAPod"><span class="toc-text">4.创建Pod</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E9%80%9A%E8%BF%87%E5%91%BD%E4%BB%A4%E5%88%9B%E5%BB%BAPod"><span class="toc-text">4.1 通过命令创建Pod</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E9%80%9A%E8%BF%87%E9%85%8D%E7%BD%AE%E5%88%9B%E5%BB%BAPod"><span class="toc-text">4.2 通过配置创建Pod</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%9F%A5%E8%AF%A2Pod"><span class="toc-text">5.查询Pod</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%88%A0%E9%99%A4Pod"><span class="toc-text">6.删除Pod</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E8%BF%9B%E5%85%A5Pod%E5%AE%B9%E5%99%A8"><span class="toc-text">7.进入Pod容器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E6%9F%A5%E7%9C%8BPod%E6%97%A5%E5%BF%97"><span class="toc-text">8.查看Pod日志</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-Pod%E8%BF%90%E8%A1%8C%E5%A4%9A%E4%B8%AA%E5%AE%B9%E5%99%A8"><span class="toc-text">10.Pod运行多个容器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-Label"><span class="toc-text">11.Label</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%B7%BB%E5%8A%A0label"><span class="toc-text">1.添加label</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%BF%AE%E6%94%B9label"><span class="toc-text">2.修改label</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%88%A0%E9%99%A4label"><span class="toc-text">3.删除label</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E7%AD%9B%E9%80%89label"><span class="toc-text">4.筛选label</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-Pod%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-text">12.Pod生命周期</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Container"><span class="toc-text">Container</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%AE%B9%E5%99%A8%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-text">1. 容器生命周期</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%9B%9E%E8%B0%83"><span class="toc-text">2. 生命周期回调</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%AE%B9%E5%99%A8%E9%87%8D%E5%90%AF%E7%AD%96%E7%95%A5"><span class="toc-text">3. 容器重启策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%AE%B9%E5%99%A8%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4"><span class="toc-text">4. 容器启动命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%AE%B9%E5%99%A8%E6%8E%A2%E9%92%88"><span class="toc-text">5. 容器探针</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%8E%A2%E9%92%88%E7%B1%BB%E5%9E%8B"><span class="toc-text">1.探针类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%8E%A2%E9%92%88%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%9C%BA%E5%88%B6"><span class="toc-text">2.探针的实现机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%8E%A2%E6%B5%8B%E7%BB%93%E6%9E%9C"><span class="toc-text">3.探测结果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%8E%A2%E9%92%88%E5%8F%82%E6%95%B0"><span class="toc-text">4.探针参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%8E%A2%E9%92%88%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">5.探针的使用</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/article/d6f32c5d.html" title="ANSI控制符"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://movies-bucket.oss-cn-beijing.aliyuncs.com/5bc57fcd37e142589c8e72351700e8c3.jpg" onerror="this.onerror=null;this.src='/img/loadError.jpeg'" alt="ANSI控制符"/></a><div class="content"><a class="title" href="/article/d6f32c5d.html" title="ANSI控制符">ANSI控制符</a><time datetime="2024-04-08T02:20:00.000Z" title="发表于 2024-04-08 10:20:00">2024-04-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/article/23837e8a.html" title="Blender笔记"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/blogCover/default.jpg" onerror="this.onerror=null;this.src='/img/loadError.jpeg'" alt="Blender笔记"/></a><div class="content"><a class="title" href="/article/23837e8a.html" title="Blender笔记">Blender笔记</a><time datetime="2024-04-08T02:18:32.000Z" title="发表于 2024-04-08 10:18:32">2024-04-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/article/d0870925.html" title="我的Debian系统配置"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://movies-bucket.oss-cn-beijing.aliyuncs.com/5092202441e14867a2591de72ec29897.jpg" onerror="this.onerror=null;this.src='/img/loadError.jpeg'" alt="我的Debian系统配置"/></a><div class="content"><a class="title" href="/article/d0870925.html" title="我的Debian系统配置">我的Debian系统配置</a><time datetime="2024-01-20T06:31:42.000Z" title="发表于 2024-01-20 14:31:42">2024-01-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/article/dec6f8bb.html" title="Go核心篇章-内存管理"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://movies-bucket.oss-cn-beijing.aliyuncs.com/95443c0654a7422fa17e4da7a1e6c493.jpeg" onerror="this.onerror=null;this.src='/img/loadError.jpeg'" alt="Go核心篇章-内存管理"/></a><div class="content"><a class="title" href="/article/dec6f8bb.html" title="Go核心篇章-内存管理">Go核心篇章-内存管理</a><time datetime="2023-11-27T14:41:56.000Z" title="发表于 2023-11-27 22:41:56">2023-11-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/article/5e8da917.html" title="Gin-源码及原理剖析"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/logo/Gin-logo.webp" onerror="this.onerror=null;this.src='/img/loadError.jpeg'" alt="Gin-源码及原理剖析"/></a><div class="content"><a class="title" href="/article/5e8da917.html" title="Gin-源码及原理剖析">Gin-源码及原理剖析</a><time datetime="2023-08-17T11:30:48.000Z" title="发表于 2023-08-17 19:30:48">2023-08-17</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By Zero</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"></div><script async src="//at.alicdn.com/t/c/font_3947604_tesead3g5v.js"></script><div class="aplayer no-destroy" data-id="2658354885" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="false"> </div><script async src="https://cdn1.tianli0.top/npm/vue@2.6.14/dist/vue.min.js"></script><script async src="https://cdn1.tianli0.top/npm/element-ui@2.15.6/lib/index.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v6.2.0" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="主题版本Butterfly_v4.3.1" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" data-title="本站采用多线部署，主线路托管于Vercel" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Hosted-Vercel-brightgreen?style=flat&amp;logo=Vercel" alt=""/></a><a class="github-badge" target="_blank" href="https://dashboard.4everland.org/" style="margin-inline:5px" data-title="本站采用多线部署，备用线路托管于4EVERLAND" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Hosted-4EVERLAND-22DDDD?style=flat&amp;logo=IPFS" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></p>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script async src="https://npm.elemecdn.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.js"></script><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><script data-pjax src="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.js"></script><script data-pjax>
  function gitcalendar_injector_config(){
      var parent_div_git = document.getElementById('gitZone');
      var item_html = '<div class="recent-post-item" id="gitcalendarBar" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 280px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animatetransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animatetransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>';
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      console.log('已挂载gitcalendar')
      }

    if( document.getElementById('gitZone') && (location.pathname ==='/about/'|| '/about/' ==='all')){
        gitcalendar_injector_config()
        GitCalendarInit("https://gitcalendar.fomal.cc/api?zlx2019",['#d9e0df', '#c6e0dc', '#a8dcd4', '#9adcd2', '#89ded1', '#77e0d0', '#5fdecb', '#47dcc6', '#39dcc3', '#1fdabe', '#00dab9'],'zlx2019')
    }
  </script><!-- hexo injector body_end end --></body></html>